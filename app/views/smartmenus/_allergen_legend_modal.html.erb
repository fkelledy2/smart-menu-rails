<!-- Allergen Legend Modal -->
<div class="modal fade" id="allergenLegendModal" tabindex="-1" aria-labelledby="allergenLegendModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="allergenLegendModalLabel">
          <i class="bi bi-info-circle-fill me-2"></i>
          <%= t('.allergen_key', default: 'Allergen Key') %>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <p class="text-muted small mb-3">
          <%= t('.allergen_key_description',
                default: 'We use short codes to identify allergens. Hover or tap any badge to see the full allergen name.') %>
        </p>

        <div class="table-responsive">
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th style="width: 80px;"><%= t('.code', default: 'Code') %></th>
                <th><%= t('.allergen', default: 'Allergen') %></th>
              </tr>
            </thead>
            <tbody>
              <% Allergyn::STANDARD_ALLERGENS.each do |code, name| %>
                <tr>
                  <td>
                    <span class="badge bg-warning text-dark"
                          style="min-width: 24px; font-weight: 700;">
                      <%= code %>
                    </span>
                  </td>
                  <td><%= name %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <% if defined?(allergyns) && allergyns.present? %>
          <%# Show restaurant-specific allergens if different from standard %>
          <% custom_allergens = allergyns.reject { |a| Allergyn::STANDARD_ALLERGENS.keys.include?(a.symbol) } %>
          <% if custom_allergens.any? %>
            <hr class="my-3">
            <h6 class="text-muted">
              <%= t('.custom_allergens', default: 'Additional Allergens') %>
            </h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <tbody>
                  <% custom_allergens.each do |allergyn| %>
                    <tr>
                      <td style="width: 80px;">
                        <span class="badge bg-warning text-dark"
                              style="min-width: 24px; font-weight: 700;">
                          <%= allergyn.symbol %>
                        </span>
                      </td>
                      <td><%= allergyn.name %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% end %>
        <% end %>

        <div class="alert alert-info mt-3 mb-0" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <small>
            <%= t('.allergen_warning',
                  default: 'If you have any food allergies or dietary restrictions, please inform your server before ordering.') %>
          </small>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <%= t('.close', default: 'Close') %>
        </button>
      </div>
    </div>
  </div>
</div>
