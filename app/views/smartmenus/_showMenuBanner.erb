  <!-- Restaurant Name & Locale Selector -->
  <% if !current_user && @restaurant&.respond_to?(:unclaimed?) && @restaurant.unclaimed? %>
    <div class="alert alert-warning mb-2" role="alert">
      <div><strong>This is an auto-generated preview</strong> based on publicly available information.</div>
      <div>
        <%= link_to 'Claim this restaurant', new_restaurant_claim_request_path(@restaurant), class: 'alert-link' %>
        Â·
        <%= link_to 'Request removal', new_restaurant_removal_request_path(@restaurant), class: 'alert-link' %>
      </div>
    </div>
  <% end %>

  <div class="header-restaurant-row">
    <% if current_user %>
      <%= link_to edit_restaurant_menu_path(@restaurant, @menu), class: 'restaurant-name' do %>
        <%= @restaurant.name %>
      <% end %>
    <% else %>
      <span class="restaurant-name"><%= @restaurant.name %></span>
    <% end %>
    
    <div class="locale-selector" id="tableLocaleSelectorContainer">
      <% if current_user %>
        <%= render partial: "showTableLocaleSelectorStaff", locals: { menu: @menu, restaurant: @restaurant, tablesetting: @tablesetting, ordrparticipant: @ordrparticipant, menuparticipant: @menuparticipant, table_smartmenus: @table_smartmenus } %>
      <% else %>
        <%= render partial: "showTableLocaleSelectorCustomer", locals: { menu: @menu, restaurant: @restaurant, tablesetting: @tablesetting, ordrparticipant: @ordrparticipant, menuparticipant: @menuparticipant, table_smartmenus: @table_smartmenus, active_locales: @active_locales, default_locale: @default_locale } %>
      <% end %>
    </div>
  <noscript>
    <style>
      /* If JS is disabled, keep header visible */
      .header-order-row { visibility: visible !important; }
    </style>
  </noscript>
  </div>

  <!-- Order Controls -->
  <div class="header-order-row" id="openOrderContainer" data-controller="order-header" style="visibility:hidden">
    <% if @openOrder %>
      <% if current_user %>
        <%= render partial: "orderStaff", locals: { order: @openOrder, menu: @openOrder.menu, restaurant: @restaurant, tablesetting: @tablesetting, ordrparticipant: @ordrparticipant, needs_age_check: @needs_age_check } %>
      <% else %>
        <%= render partial: "orderCustomer", locals: { order: @openOrder, menu: @openOrder.menu, restaurant: @restaurant, tablesetting: @tablesetting, ordrparticipant: @ordrparticipant } %>
      <% end %>
    <% else %>
      <% if current_user %>
        <%= render partial: "orderStaff", locals: { order: nil, menu: @menu, restaurant: @restaurant, tablesetting: @tablesetting, ordrparticipant: @ordrparticipant, needs_age_check: @needs_age_check } %>
      <% else %>
        <%= render partial: "orderCustomer", locals: { order: nil, menu: @menu, restaurant: @restaurant, tablesetting: @tablesetting, ordrparticipant: @ordrparticipant } %>
      <% end %>
    <% end %>
  </div>
  <!-- Navigation: Search & Sections -->
  <div class="menu-sections-nav-mobile">
    <!-- Search and Filter Row -->
    <div class="sections-filter-row">
      <input type="text" 
             id="menu-item-search" 
             class="menu-search-input" 
             placeholder="<%= t('.search_menu', default: 'Search menu...') %>">
      
      <% unless current_user %>
        <% if @ordrparticipant %>
          <button type="button" 
                  class="filter-button" 
                  data-bs-toggle="modal" 
                  data-bs-restaurant="<%= @restaurant.id %>" 
                  data-bs-menu="<%= @menu.id %>" 
                  data-bs-target="#filterOrderModal"
                  aria-label="<%= t('.filter_allergens', default: 'Filter allergens') %>">
            <i class="bi bi-filter"></i>
            <% if @ordrparticipant.allergyns.size > 0 %>
              <span class="filter-badge"><%= @ordrparticipant.allergyns.size %></span>
            <% end %>
          </button>
        <% end %>
      <% end %>
      
      <!-- Allergen Legend Info Button -->
      <button type="button" 
              class="filter-button" 
              data-bs-toggle="modal" 
              data-bs-target="#allergenLegendModal"
              aria-label="<%= t('.allergen_key', default: 'Allergen key') %>"
              title="<%= t('.view_allergen_key', default: 'View allergen key') %>">
        <i class="bi bi-info-circle"></i>
      </button>
    </div>
    
    <!-- Section Tabs -->
    <div class="sections-tabs-container">
      <nav id="navbar-example2" class="sections-tabs">
        <% @menu.menusections.sort_by { |s| s.sequence.to_i }.each do |menusection| %>
          <a class="section-tab sectionnav" href="#menusection_<%= menusection.id %>">
            <% if @ordrparticipant && @ordrparticipant.preferredlocale %>
              <%= menusection.localised_name(@ordrparticipant.preferredlocale) %>
            <% elsif @menuparticipant && @menuparticipant.preferredlocale %>
              <%= menusection.localised_name(@menuparticipant.preferredlocale) %>
            <% else %>
              <%= menusection.name %>
            <% end %>
          </a>
        <% end %>
        <a class="section-tab" href="#menusection_allergyns">
          <%= t(".allergyns", default: 'Allergens') %>
        </a>
      </nav>
    </div>
  </div>