<%# 
  Restaurant Menus Section
  Menu list and management
%>

<% restaurant = local_assigns[:restaurant] || @restaurant %>
<% filter = local_assigns[:filter] || 'all' %>

<% 
  menus = case filter
          when 'active'
            restaurant.menus.where(archived: false, status: 'active')
          when 'draft'
            restaurant.menus.where(archived: false, status: 'inactive')
          else
            restaurant.menus.where(archived: false)
          end
  menus = menus.order(:sequence)
%>

<!-- Menus Header with Actions -->
<div class="content-card-2025">
  <div class="menus-header-wrapper">
    <h2 class="content-card-title mb-0">
      <i class="bi bi-menu-button-wide"></i>
      <%= t(".menus_#{filter}", default: filter.titleize + ' Menus') %>
    </h2>
    
    <div class="menus-header-actions">
      <%= link_to new_restaurant_menu_path(restaurant), 
          class: 'btn-2025 btn-2025-primary btn-2025-md' do %>
        <i class="bi bi-plus-circle"></i>
        <span class="btn-text"><%= t('.new_menu', default: 'New Menu') %></span>
      <% end %>
      
      <%= link_to new_restaurant_ocr_menu_import_path(restaurant), 
          class: 'btn-2025 btn-2025-secondary btn-2025-md' do %>
        <i class="bi bi-file-earmark-arrow-up"></i>
        <span class="btn-text"><%= t('.bulk_import', default: 'Import') %></span>
      <% end %>
    </div>
  </div>
  
  <!-- Filter Tabs -->
  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <%= link_to edit_restaurant_path(restaurant, section: 'menus'), 
          class: "nav-link #{'active' if filter == 'all'}",
          data: { turbo_frame: 'restaurant_content', turbo_action: 'advance' } do %>
        <%= t('.all', default: 'All') %> 
        <span class="badge bg-secondary"><%= restaurant.menus.where(archived: false).count %></span>
      <% end %>
    </li>
    <li class="nav-item">
      <%= link_to edit_restaurant_path(restaurant, section: 'menus_active'), 
          class: "nav-link #{'active' if filter == 'active'}",
          data: { turbo_frame: 'restaurant_content', turbo_action: 'advance' } do %>
        <%= t('.active', default: 'Active') %> 
        <span class="badge bg-success"><%= restaurant.menus.where(archived: false, status: 'active').count %></span>
      <% end %>
    </li>
    <li class="nav-item">
      <%= link_to edit_restaurant_path(restaurant, section: 'menus_draft'), 
          class: "nav-link #{'active' if filter == 'draft'}",
          data: { turbo_frame: 'restaurant_content', turbo_action: 'advance' } do %>
        <%= t('.draft', default: 'Draft') %> 
        <span class="badge bg-warning"><%= restaurant.menus.where(archived: false, status: 'inactive').count %></span>
      <% end %>
    </li>
  </ul>
  
  <% if menus.any? %>
    <!-- Menus Grid -->
    <div class="menus-grid">
      <% menus.each do |menu| %>
        <div class="menu-card">
          <div class="menu-card-header">
            <h3 class="menu-card-title">
              <%= menu.name %>
            </h3>
            
            <div class="menu-card-badges">
              <% if menu.active? %>
                <span class="badge bg-success">
                  <i class="bi bi-check-circle"></i> <%= t('.active', default: 'Active') %>
                </span>
              <% elsif menu.inactive? %>
                <span class="badge bg-warning text-dark">
                  <i class="bi bi-pencil"></i> <%= t('.inactive', default: 'Inactive') %>
                </span>
              <% end %>
            </div>
          </div>
          
          <div class="menu-card-body">
            <% if menu.description.present? %>
              <p class="menu-card-description">
                <%= truncate(menu.description, length: 100) %>
              </p>
            <% end %>
            
            <div class="menu-card-stats">
              <span class="stat-badge">
                <i class="bi bi-grid-3x3"></i>
                <%= menu.menusections.count %> <%= t('.sections', default: 'sections') %>
              </span>
              
              <span class="stat-badge">
                <i class="bi bi-list"></i>
                <%= menu.menusections.joins(:menuitems).count('menuitems.id') %> <%= t('.items', default: 'items') %>
              </span>
            </div>
          </div>
          
          <div class="menu-card-actions">
            <%= link_to edit_restaurant_menu_path(restaurant, menu), 
                class: 'btn-2025 btn-2025-primary btn-2025-sm flex-fill',
                data: { turbo_frame: '_top' } do %>
              <i class="bi bi-pencil"></i> <%= t('.edit', default: 'Edit') %>
            <% end %>
            
            <% if menu.smartmenu&.slug %>
              <%= link_to smartmenu_path(menu.smartmenu.slug), 
                  class: 'btn-2025 btn-2025-ghost btn-2025-sm',
                  target: '_blank',
                  title: t('.preview', default: 'Preview Menu') do %>
                <i class="bi bi-eye"></i>
              <% end %>
            <% else %>
              <button class="btn-2025 btn-2025-ghost btn-2025-sm" 
                      disabled
                      title="<%= t('.no_preview', default: 'Menu not published yet') %>">
                <i class="bi bi-eye"></i>
              </button>
            <% end %>
            
            <div class="dropdown">
              <button class="btn-2025 btn-2025-ghost btn-2025-sm" 
                      type="button" 
                      data-bs-toggle="dropdown">
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <%= link_to '#', class: 'dropdown-item' do %>
                    <i class="bi bi-files"></i> <%= t('.duplicate', default: 'Duplicate') %>
                  <% end %>
                </li>
                <li>
                  <%= link_to '#', class: 'dropdown-item' do %>
                    <i class="bi bi-download"></i> <%= t('.export', default: 'Export') %>
                  <% end %>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <%= link_to restaurant_menu_path(restaurant, menu), 
                      method: :delete,
                      data: { confirm: t('.confirm_delete', default: 'Are you sure?') },
                      class: 'dropdown-item text-danger' do %>
                    <i class="bi bi-trash"></i> <%= t('.delete', default: 'Delete') %>
                  <% end %>
                </li>
              </ul>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="text-center py-5">
      <i class="bi bi-menu-button-wide text-muted" style="font-size: 3rem;"></i>
      <h3 class="mt-3 text-muted">
        <%= t('.no_menus', default: 'No menus found') %>
      </h3>
      <p class="text-muted">
        <%= t('.no_menus_description', default: 'Create your first menu to get started') %>
      </p>
      <%= link_to new_restaurant_menu_path(restaurant), 
          class: 'btn-2025 btn-2025-primary btn-2025-lg mt-3' do %>
        <i class="bi bi-plus-circle"></i>
        <%= t('.create_first_menu', default: 'Create Your First Menu') %>
      <% end %>
    </div>
  <% end %>
</div>

<style>
  /* Header Layout - Responsive */
  .menus-header-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
    gap: var(--space-3);
  }
  
  .menus-header-actions {
    display: flex;
    gap: var(--space-2);
    flex-shrink: 0;
  }
  
  /* Mobile Header - Stack vertically */
  @media (max-width: 768px) {
    .menus-header-wrapper {
      flex-direction: column;
      align-items: stretch;
    }
    
    .menus-header-actions {
      width: 100%;
      justify-content: stretch;
    }
    
    .menus-header-actions .btn-2025 {
      flex: 1;
      justify-content: center;
    }
    
    /* Hide button text on very small screens, show icon only */
    @media (max-width: 480px) {
      .menus-header-actions .btn-text {
        display: none;
      }
    }
  }
  
  /* Menus Grid - Responsive */
  .menus-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-4);
  }
  
  /* Mobile Grid - Single column */
  @media (max-width: 768px) {
    .menus-grid {
      grid-template-columns: 1fr;
      gap: var(--space-3);
    }
  }
  
  .menu-card {
    background: white;
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--transition-base);
  }
  
  .menu-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }
  
  .menu-card-header {
    padding: var(--space-4);
    border-bottom: 1px solid var(--color-gray-100);
  }
  
  /* Mobile Card Header - Reduce padding */
  @media (max-width: 480px) {
    .menu-card-header {
      padding: var(--space-3);
    }
  }
  
  .menu-card-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-gray-900);
    margin: 0 0 var(--space-2) 0;
  }
  
  /* Mobile Title - Smaller font */
  @media (max-width: 480px) {
    .menu-card-title {
      font-size: var(--text-base);
    }
  }
  
  .menu-card-badges {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
  }
  
  .menu-card-body {
    padding: var(--space-4);
  }
  
  /* Mobile Card Body - Reduce padding */
  @media (max-width: 480px) {
    .menu-card-body {
      padding: var(--space-3);
    }
  }
  
  .menu-card-description {
    color: var(--color-gray-600);
    font-size: var(--text-sm);
    margin-bottom: var(--space-3);
  }
  
  .menu-card-stats {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
  }
  
  .stat-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-xs);
    color: var(--color-gray-600);
  }
  
  .menu-card-actions {
    display: flex;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--color-gray-50);
    border-top: 1px solid var(--color-gray-100);
  }
  
  /* Mobile Card Actions - Better spacing */
  @media (max-width: 480px) {
    .menu-card-actions {
      padding: var(--space-2) var(--space-3);
      gap: var(--space-1);
    }
    
    .menu-card-actions .btn-2025 {
      padding: var(--space-2);
      font-size: var(--text-xs);
    }
  }
  
  /* Filter Tabs - Mobile Scrollable */
  @media (max-width: 768px) {
    .nav-tabs {
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
    }
    
    .nav-tabs .nav-item {
      flex-shrink: 0;
    }
    
    .nav-tabs::-webkit-scrollbar {
      height: 3px;
    }
    
    .nav-tabs::-webkit-scrollbar-thumb {
      background: var(--color-gray-300);
      border-radius: 3px;
    }
  }
</style>
