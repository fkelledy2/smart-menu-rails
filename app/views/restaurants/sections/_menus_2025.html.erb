<%#
  Restaurant Menus Section
  Menu list and management
%>

<% restaurant = local_assigns[:restaurant] || @restaurant %>

<% 
  include_archived_menus = params[:include_archived_menus].to_s == '1'

  restaurant_menus_scope = restaurant.restaurant_menus
    .joins(:menu)

  unless include_archived_menus
    restaurant_menus_scope = restaurant_menus_scope
      .where.not(status: RestaurantMenu.statuses[:archived])
      .where(menus: { archived: false })
  end

  restaurant_menus = restaurant_menus_scope
    .includes(:menu)
    .order(Arel.sql('CASE WHEN restaurant_menus.sequence IS NULL THEN 1 ELSE 0 END, restaurant_menus.sequence ASC'))
    .to_a

  plan = restaurant.user&.plan
  menus_limit = plan&.menusperlocation
  active_menus_count = restaurant.restaurant_menus
    .joins(:menu)
    .where(menus: { archived: false })
    .where(status: RestaurantMenu.statuses[:active])
    .count
  can_add_menu = menus_limit == -1 || (menus_limit.to_i > 0 && active_menus_count < menus_limit.to_i)
  disabled_menu_action_message = if menus_limit.present? && menus_limit.to_i > 0
    "Your plan allows up to #{menus_limit} active menu#{menus_limit.to_i == 1 ? '' : 's'} per restaurant. Archive or deactivate a menu to add another."
  else
    'You cannot add more menus on your current plan.'
  end

  show_availability_column = restaurant_menus.any? do |rm|
    m = rm.menu
    owner_id = m.owner_restaurant_id.presence || m.restaurant_id
    owner_id != restaurant.id
  end

  recent_completed_import = begin
    restaurant.ocr_menu_imports.completed.where.not(menu_id: nil).first
  rescue StandardError
    nil
  end

  imported_menu = begin
    if recent_completed_import&.menu_id.present?
      restaurant.menus.where(id: recent_completed_import.menu_id).first
    else
      nil
    end
  rescue StandardError
    nil
  end

  newly_imported_menu = begin
    imported_menu.present? && recent_completed_import&.completed_at.present? && recent_completed_import.completed_at >= 14.days.ago
  rescue StandardError
    false
  end

  menu_smartmenu_slug = begin
    imported_menu&.smartmenu&.slug.to_s.presence
  rescue StandardError
    nil
  end

  missing_image_prompt_count = begin
    imported_menu.present? ? imported_menu.menuitems.where.not(itemtype: Menuitem.itemtypes[:wine]).where("COALESCE(image_prompt,'') = ''").count : 0
  rescue StandardError
    0
  end

  has_translation = begin
    if imported_menu.present?
      active_locales = Restaurantlocale.where(restaurant_id: restaurant.id, status: 'active')
      default_locale = active_locales.find { |x| x.dfault == true }
      non_default = active_locales.reject { |x| default_locale && x.id == default_locale.id }
      non_default.any? && imported_menu.menulocales.where(locale: non_default.map(&:locale)).exists?
    else
      false
    end
  rescue StandardError
    false
  end

  has_any_ai_image = begin
    imported_menu.present? && imported_menu.menuitems.where.not(image_data: [nil, '']).exists?
  rescue StandardError
    false
  end
%>

<% if newly_imported_menu %>
  <div class="card mb-3" data-testid="menu-go-live-flow" data-controller="go-live-progress">
    <div class="card-body py-3">
      <% ai_polish_complete = (missing_image_prompt_count.to_i == 0) %>
      <% menu_go_live_steps = [
        { label: 'AI Polish', complete: ai_polish_complete, path: (imported_menu.present? ? edit_restaurant_menu_path(restaurant, imported_menu, section: 'details') : nil) },
        { label: 'Add a translation', complete: has_translation, path: (ai_polish_complete && imported_menu.present? ? edit_restaurant_menu_path(restaurant, imported_menu, section: 'details') : nil) },
        { label: 'Generate AI Images', complete: has_any_ai_image, path: (ai_polish_complete && imported_menu.present? ? edit_restaurant_menu_path(restaurant, imported_menu, section: 'details') : nil) },
        { label: 'Preview as Staff', complete: menu_smartmenu_slug.present?, path: (ai_polish_complete && menu_smartmenu_slug.present? ? smartmenu_path(menu_smartmenu_slug) : nil) },
        { label: 'Preview as Customer', complete: menu_smartmenu_slug.present?, path: (ai_polish_complete && menu_smartmenu_slug.present? ? smartmenu_path(menu_smartmenu_slug, view: 'customer') : nil) },
      ] %>
      <% completed_steps = menu_go_live_steps.count { |s| s[:complete] } %>
      <% total_steps = menu_go_live_steps.size %>
      <% percent_complete = total_steps.positive? ? ((completed_steps.to_f / total_steps) * 100).round : 0 %>
      <% go_live_complete = (completed_steps == total_steps) %>

      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div class="d-flex align-items-center gap-2">
          <div class="fw-semibold">Menu go live flow</div>
        </div>
        <div class="d-flex align-items-center gap-3">
          <div class="text-muted small"><%= completed_steps %>/<%= total_steps %></div>
          <button class="btn btn-sm btn-outline-secondary"
                  type="button"
                  aria-expanded="false"
                  aria-controls="go-live-progress-details"
                  data-go-live-progress-target="toggle"
                  data-action="click->go-live-progress#toggle mouseenter->go-live-progress#open">
            <i class="bi bi-chevron-right" data-go-live-progress-target="chevron"></i>
          </button>
        </div>
      </div>

      <div class="progress mt-2" style="height: 8px;" role="progressbar" aria-valuenow="<%= percent_complete %>" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar <%= go_live_complete ? 'bg-success' : 'progress-bar-striped progress-bar-animated' %>" style="width: <%= percent_complete %>%;"></div>
      </div>

      <div class="collapse mt-3" id="go-live-progress-details" data-go-live-progress-target="details" data-action="mouseenter->go-live-progress#open mouseleave->go-live-progress#close">
        <div class="row g-2">
          <% menu_go_live_steps.each do |step| %>
            <div class="col-12 col-md-6 col-lg-4">
              <div class="d-flex align-items-start gap-2 small">
                <% if step[:complete] %>
                  <i class="bi bi-check-circle-fill text-success mt-1"></i>
                  <div class="text-muted"><%= step[:label] %></div>
                <% else %>
                  <i class="bi bi-circle text-muted mt-1"></i>
                  <% if step[:path].present? %>
                    <%= link_to step[:label], step[:path], class: 'text-decoration-none', data: { turbo_frame: '_top' } %>
                  <% else %>
                    <div class="text-muted"><%= step[:label] %></div>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<!-- Quick Actions Card -->
<div id="restaurant-menus-section"></div>
<div class="mb-3 p-3" data-testid="menus-quick-actions">
  <h2 class="quick-actions-title">
    <i class="bi bi-lightning-charge"></i>
    <%= t('.quick_actions') %>
  </h2>

  <div class="quick-actions-grid">
    <% if can_add_menu %>
      <%= link_to new_restaurant_menu_path(restaurant),
          class: 'quick-action-btn',
          data: { testid: 'new-menu-btn', turbo_frame: '_top' } do %>
        <i class="bi bi-plus-circle"></i>
        <span><%= t('.new_menu') %></span>
      <% end %>
    <% else %>
      <%= link_to '#',
          class: 'quick-action-btn disabled',
          title: disabled_menu_action_message,
          aria: { disabled: true },
          data: { controller: 'disabled-action', action: 'click->disabled-action#explain', disabled_action_title_value: 'Menu limit reached', disabled_action_message_value: disabled_menu_action_message, testid: 'new-menu-btn', turbo: false } do %>
        <i class="bi bi-plus-circle"></i>
        <span><%= t('.new_menu') %></span>
      <% end %>
    <% end %>

    <% if can_add_menu %>
      <%= link_to edit_restaurant_path(restaurant, section: 'import'),
          class: 'quick-action-btn',
          data: { testid: 'import-menu-btn', turbo_frame: 'restaurant_content', turbo_action: 'advance' } do %>
        <i class="bi bi-file-earmark-arrow-up"></i>
        <span><%= t('.import_menu') %></span>
      <% end %>
    <% else %>
      <%= link_to '#',
          class: 'quick-action-btn disabled',
          title: disabled_menu_action_message,
          aria: { disabled: true },
          data: { controller: 'disabled-action', action: 'click->disabled-action#explain', disabled_action_title_value: 'Menu limit reached', disabled_action_message_value: disabled_menu_action_message, testid: 'import-menu-btn', turbo: false } do %>
        <i class="bi bi-file-earmark-arrow-up"></i>
        <span><%= t('.import_menu') %></span>
      <% end %>
    <% end %>
  </div>
</div>

<style>
  /* Force Quick Actions into two columns on all viewports (including mobile portrait) */
  .quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--space-3);
  }
  .quick-actions-grid .quick-action-btn {
    width: 100%;
    justify-content: center;
  }

  .quick-action-btn.disabled {
    opacity: 0.55;
    cursor: not-allowed;
    filter: grayscale(25%);
    pointer-events: auto;
  }

  tr.menu-row-shared {
    background: rgba(13, 110, 253, 0.03);
    border-left: 3px solid rgba(13, 110, 253, 0.25);
  }

  tr.menu-row-owned {
    border-left: 3px solid transparent;
  }

  .menu-origin-badge {
    font-weight: 600;
    letter-spacing: 0.01em;
  }
</style>

<!-- Menus List -->
<div class="mb-3 p-3" data-testid="menus-list-card">
  <div class="d-flex justify-content-between align-items-center mb-3 gap-2 flex-wrap">
    <h2 class="h5 mb-0">
      <i class="bi bi-grid-3x3"></i>
      <%= t('.menus') %>
    </h2>

    <%= link_to(
      include_archived_menus ? t('.hide_archived', default: 'Hide archived') : t('.show_archived', default: 'Show archived'),
      edit_restaurant_path(restaurant, section: 'menus', include_archived_menus: include_archived_menus ? nil : 1),
      class: 'btn btn-sm btn-outline-secondary',
      data: { turbo_frame: 'restaurant_content', turbo_action: 'advance', testid: 'toggle-include-archived-menus' }
    ) %>
  </div>

  <% if restaurant_menus.any? %>
    <!-- Menus List (styled like Table Settings) -->
    <div data-controller="restaurantmenus-bulk">
    <%= form_with url: bulk_update_restaurant_restaurant_menus_path(restaurant), method: :patch, data: { turbo: true, action: 'submit->restaurantmenus-bulk#beforeSubmit' } do |f| %>
      <%= hidden_field_tag :operation, '', data: { restaurantmenus_bulk_target: 'operation' } %>
      <%= hidden_field_tag :value, '', data: { restaurantmenus_bulk_target: 'value' } %>
      <div class="table-responsive menus-table-view"
           data-testid="menus-list">
        <table class="table table-hover align-middle">
        <thead>
          <% if show_availability_column %>
            <tr class="small text-muted">
              <th class="w-20px menu-compact-cell"></th>
              <th class="w-20px menu-compact-cell"></th>
              <th></th>
              <th class="text-end"><%= t('.availability', default: 'Availability') %></th>
              <th></th>
            </tr>
          <% end %>
          <tr>
            <th class="w-20px menu-compact-cell">
              <input type="checkbox" data-restaurantmenus-bulk-target="selectAll" data-action="change->restaurantmenus-bulk#toggleAll" />
            </th>
            <th class="text-end text-nowrap" colspan="<%= show_availability_column ? 4 : 3 %>">
              <div class="d-flex justify-content-end flex-nowrap">
                <div class="input-group input-group-sm flex-nowrap" style="min-width: 260px; width: auto;">
                  <select class="form-select form-select-sm" style="min-width: 0;" data-restaurantmenus-bulk-target="actionSelect" data-action="change->restaurantmenus-bulk#sync">
                    <option value=""><%= t('.bulk_action', default: 'Bulk action…') %></option>
                    <option value="set_status"><%= t('.bulk_set_status', default: 'Set status') %></option>
                    <option value="archive"><%= t('.bulk_archive', default: 'Archive') %></option>
                    <option value="restore"><%= t('.bulk_restore', default: 'Restore') %></option>
                  </select>
                  <button type="submit"
                          class="btn btn-primary"
                          title="<%= t('.apply') %>"
                          aria-label="<%= t('.apply') %>"
                          disabled
                          data-restaurantmenus-bulk-target="apply"
                          data-action="click->restaurantmenus-bulk#apply">
                    <i class="bi bi-check2"></i>
                    <span class="visually-hidden"><%= t('.apply') %></span>
                  </button>
                </div>
              </div>
            </th>
          </tr>
        </thead>
        <tbody data-controller="sortable"
               data-sortable-url-value="<%= reorder_restaurant_restaurant_menus_path(restaurant) %>"
               data-sortable-handle-value=".drag-handle">
          <% restaurant_menus.each do |restaurant_menu| %>
            <% menu = restaurant_menu.menu %>
            <% owner_restaurant_id = menu.owner_restaurant_id.presence || menu.restaurant_id %>
            <% row_status = restaurant_menu.status.to_s %>
            <tr data-sortable-id="<%= restaurant_menu.id %>"
                data-testid="menu-row-<%= menu.id %>"
                data-href="<%= edit_restaurant_menu_path(restaurant, menu) %>"
                class="<%= owner_restaurant_id == restaurant.id ? 'menu-row-owned' : 'menu-row-shared' %> clickable-row row-status-<%= row_status %> <%= row_status == 'inactive' ? 'menu-row-muted' : '' %>"
                title="<%= t(".#{row_status}") %>">
              <td class="w-20px menu-compact-cell">
                <input type="checkbox" name="restaurant_menu_ids[]" value="<%= restaurant_menu.id %>" data-restaurantmenus-bulk-target="checkbox" data-action="change->restaurantmenus-bulk#sync" />
              </td>
              <td class="w-20px menu-compact-cell">
                <i class="bi bi-grip-vertical text-muted drag-handle" title="<%= t('.drag_to_reorder') %>"></i>
              </td>
              <td>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <div class="fw-semibold"><%= menu.name %></div>
                  <% unless owner_restaurant_id == restaurant.id %>
                    <span class="badge bg-light text-primary menu-origin-badge">
                      <i class="bi bi-link-45deg"></i>
                      <%= t('.shared') %>
                    </span>
                  <% end %>
                </div>
                <% if menu.description.present? %>
                  <div class="text-muted small"><%= truncate(menu.description, length: 80) %></div>
                <% end %>
              </td>
              <% if show_availability_column %>
                <td class="text-end">
                  <% if owner_restaurant_id != restaurant.id %>
                    <% availability_value = if restaurant_menu.availability_override_enabled?
                      restaurant_menu.availability_state.to_s
                    else
                      'default'
                    end %>

                    <%= form_with url: availability_restaurant_restaurant_menu_path(restaurant, restaurant_menu),
                          method: :patch,
                          data: { turbo_frame: '_top' },
                          class: 'd-inline' do %>
                      <input type="hidden" name="availability_override_enabled" value="<%= availability_value == 'default' ? 'false' : 'true' %>" />
                      <input type="hidden" name="availability_state" value="<%= availability_value == 'default' ? 'available' : availability_value %>" />
                      <select class="form-select form-select-sm d-inline-block w-auto"
                              name="availability_select"
                              onchange="this.form.querySelector('input[name=availability_override_enabled]').value=(this.value==='default'?'false':'true'); this.form.querySelector('input[name=availability_state]').value=(this.value==='default'?'available':this.value); this.form.requestSubmit();">
                        <option value="default" <%= 'selected' if availability_value == 'default' %>><%= t('.default') %></option>
                        <option value="available" <%= 'selected' if availability_value == 'available' %>><%= t('.available') %></option>
                        <option value="unavailable" <%= 'selected' if availability_value == 'unavailable' %>><%= t('.unavailable') %></option>
                      </select>
                    <% end %>
                  <% end %>
                </td>
              <% end %>
              <td class="text-end">
                <div class="d-flex justify-content-end align-items-center gap-2">
                  <% unless owner_restaurant_id == restaurant.id %>
                    <%= button_to t('.detach'),
                        detach_restaurant_menu_path(restaurant, menu),
                        method: :delete,
                        form: { data: { turbo_frame: '_top' } },
                        class: 'btn btn-sm btn-outline-secondary' %>
                  <% end %>

                  <% if owner_restaurant_id == restaurant.id %>
                    <% other_restaurants = Restaurant.where(user_id: current_user.id).where.not(id: restaurant.id) %>
                    <% if other_restaurants.any? %>
                      <%= form_with url: share_restaurant_menu_path(restaurant, menu), method: :post, data: { turbo_frame: '_top' } do |f| %>
                        <div class="input-group input-group-sm menu-share-controls" style="width: 184px; max-width: 184px;">
                          <select class="form-select"
                                  name="target_restaurant_ids[]"
                                  aria-label="<%= t('.share') %>">
                            <option value="" selected disabled><%= t('.share_menu') %></option>
                            <option value="all"><%= t('.share_to_all') %></option>
                            <% other_restaurants.each do |r| %>
                              <option value="<%= r.id %>"><%= r.name %></option>
                            <% end %>
                          </select>
                          <button type="submit"
                                  class="btn btn-secondary"
                                  title="<%= t('.share') %>"
                                  aria-label="<%= t('.share') %>">
                            <i class="bi bi-send"></i>
                          </button>
                        </div>
                      <% end %>
                    <% end %>
                  <% end %>

                  <%= link_to edit_restaurant_menu_path(restaurant, menu),
                      class: 'd-inline-flex align-items-center justify-content-end text-decoration-none link-secondary',
                      title: t('.edit'),
                      aria: { label: t('.edit') },
                      data: { row_primary_link: true, turbo_frame: '_top' } do %>
                    <i class="bi bi-chevron-right"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Mobile Card View (compact like localization list) -->
    <div class="menus-cards-view"
         data-controller="sortable"
         data-sortable-url-value="<%= reorder_restaurant_restaurant_menus_path(restaurant) %>"
         data-sortable-handle-value=".drag-handle">
      <% restaurant_menus.each do |restaurant_menu| %>
        <% menu = restaurant_menu.menu %>
        <% owner_restaurant_id = menu.owner_restaurant_id.presence || menu.restaurant_id %>
        <% row_status = restaurant_menu.status.to_s %>
  
        <div class="menu-card-mobile clickable-row row-status-<%= row_status %> <%= row_status == 'inactive' ? 'menu-row-muted' : '' %>"
             data-sortable-id="<%= restaurant_menu.id %>"
             data-href="<%= edit_restaurant_menu_path(restaurant, menu) %>"
             title="<%= t(".#{row_status}") %>">
          <div class="menu-row-mobile">
            <div class="menu-row-mobile-left">
              <input type="checkbox"
                     name="restaurant_menu_ids[]"
                     value="<%= restaurant_menu.id %>"
                     data-restaurantmenus-bulk-target="checkbox"
                     data-action="change->restaurantmenus-bulk#sync" />
  
              <span class="drag-handle cursor-grab" aria-hidden="true">
                <i class="bi bi-grip-vertical text-muted" title="<%= t('.drag_to_reorder') %>"></i>
              </span>
  
              <div class="menu-row-mobile-text">
                <div class="fw-semibold d-flex align-items-center gap-2">
                  <span class="menu-name"><%= menu.name %></span>
                  <% unless owner_restaurant_id == restaurant.id %>
                    <span class="badge bg-light text-primary menu-origin-badge">
                      <i class="bi bi-link-45deg"></i>
                      <%= t('.shared') %>
                    </span>
                  <% end %>
                </div>
                <% if menu.description.present? %>
                  <div class="text-muted small"><%= truncate(menu.description, length: 60) %></div>
                <% end %>
              </div>
            </div>
  
            <%= link_to edit_restaurant_menu_path(restaurant, menu),
                class: 'd-inline-flex align-items-center justify-content-end text-decoration-none link-secondary',
                title: t('.edit'),
                aria: { label: t('.edit') },
                data: { row_primary_link: true, turbo_frame: '_top' } do %>
              <i class="bi bi-chevron-right"></i>
            <% end %>
          </div>

          <% if show_availability_column && owner_restaurant_id != restaurant.id %>
            <% availability_value = if restaurant_menu.availability_override_enabled?
              restaurant_menu.availability_state.to_s
            else
              'default'
            end %>
  
            <div class="mt-2">
              <%= form_with url: availability_restaurant_restaurant_menu_path(restaurant, restaurant_menu),
                    method: :patch,
                    data: { turbo_frame: '_top' },
                    class: 'd-inline' do %>
                <input type="hidden" name="availability_override_enabled" value="<%= availability_value == 'default' ? 'false' : 'true' %>" />
                <input type="hidden" name="availability_state" value="<%= availability_value == 'default' ? 'available' : availability_value %>" />
                <select class="form-select form-select-sm d-inline-block w-100"
                        name="availability_select"
                        onchange="this.form.querySelector('input[name=availability_override_enabled]').value=(this.value==='default'?'false':'true'); this.form.querySelector('input[name=availability_state]').value=(this.value==='default'?'available':this.value); this.form.requestSubmit();">
                  <option value="default" <%= 'selected' if availability_value == 'default' %>><%= t('.default') %></option>
                  <option value="available" <%= 'selected' if availability_value == 'available' %>><%= t('.available') %></option>
                  <option value="unavailable" <%= 'selected' if availability_value == 'unavailable' %>><%= t('.unavailable') %></option>
                </select>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="modal fade" tabindex="-1" aria-hidden="true" data-restaurantmenus-bulk-target="modal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" data-restaurantmenus-bulk-target="modalTitle">Bulk edit</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-none" data-restaurantmenus-bulk-target="modalBodyArchive">
              <p class="mb-0"><%= t('.archive_confirm', default: 'This will archive the selected menus for this restaurant.') %></p>
            </div>

            <div class="d-none" data-restaurantmenus-bulk-target="modalBodyRestore">
              <p class="mb-0"><%= t('.restore_confirm', default: 'This will restore the selected menus for this restaurant.') %></p>
            </div>

            <div class="d-none" data-restaurantmenus-bulk-target="modalBodyStatus">
              <label class="form-label"><%= t('.status', default: 'Status') %></label>
              <select class="form-select" data-restaurantmenus-bulk-target="modalStatusSelect">
                <option value=""><%= t('.choose_status', default: 'Choose…') %></option>
                <% if current_user_has_active_subscription? %>
                  <option value="active"><%= t('.active') %></option>
                <% end %>
                <option value="inactive"><%= t('.inactive') %></option>
              </select>
            </div>
          </div>
          <div class="modal-footer gap-2">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"><%= t('common.cancel', default: 'Cancel') %></button>
            <button type="button" class="btn btn-primary" data-restaurantmenus-bulk-target="modalApply" data-action="click->restaurantmenus-bulk#confirmModalApply"><%= t('.apply', default: 'Apply') %></button>
          </div>
        </div>
      </div>
    </div>

    <% end %>
  <% else %>
    <!-- Empty State -->
    <div class="text-center py-5">
      <i class="bi bi-menu-button-wide text-muted text-3rem"></i>
      <h3 class="mt-3 text-muted">
        <%= t('.no_menus') %>
      </h3>
      <p class="text-muted">
        <%= t('.no_menus_description') %>
      </p>
    </div>
  <% end %>
</div>

<style>
  /* Align actions in a column at the right so the badge sits above the dropdown */
  .menu-card { display: flex; align-items: stretch; gap: 12px; }
  .menu-card-main { flex: 1 1 auto; }
  .menu-card-actions { display: flex; flex-direction: column; align-items: flex-end; }
  .menu-status-badge { line-height: 1; }

  tr.clickable-row { cursor: pointer; }

  tr.menu-row-muted td {
    color: var(--color-gray-500);
  }

  tr.menu-row-muted td .fw-semibold {
    color: var(--color-gray-600);
  }

  .menu-share-controls {
    flex: 0 0 184px;
  }

  .menus-table-view th.menu-compact-cell,
  .menus-table-view td.menu-compact-cell {
    padding-left: 0.35rem;
    padding-right: 0.35rem;
  }

  /* Menus Views - Responsive (match localization list) */
  .menus-table-view {
    display: block;
  }

  .menus-cards-view {
    display: none;
  }

  @media (max-width: 768px) {
    .menus-table-view {
      display: block;
    }

    .menus-cards-view {
      display: none;
    }
  }

  .menu-card-mobile {
    background: var(--color-gray-50);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    padding: var(--space-3);
    margin-bottom: var(--space-2);
    transition: all var(--transition-base);
  }

  .menu-card-mobile:hover {
    box-shadow: var(--shadow-sm);
    border-color: var(--color-gray-300);
  }

  .menu-card-mobile:last-child {
    margin-bottom: 0;
  }

  .menu-row-mobile {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
  }

  .menu-row-mobile-left {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    min-width: 0;
    flex: 1;
  }

  .menu-row-mobile-text {
    min-width: 0;
    flex: 1;
  }

  .menu-row-mobile-text .menu-name {
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  @media (max-width: 480px) {
    .menus-table-view th.menu-compact-cell,
    .menus-table-view td.menu-compact-cell {
      padding-left: 0.2rem;
      padding-right: 0.2rem;
    }
  }

  @media (max-width: 480px) {
    .menu-share-controls {
      display: none;
    }
  }
</style>

<style>
  /* Menus List - Single Column */
  .menus-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  /* Menu Card - Horizontal Layout */
  .menu-card {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    background: white;
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    transition: all var(--transition-base);
  }

  .menu-card:hover {
    box-shadow: var(--shadow-md);
    border-color: var(--color-gray-300);
  }

  /* Sortable states */
  .sortable-ghost {
    opacity: 0.4;
    background: var(--color-gray-50);
  }

  .sortable-drag {
    opacity: 1;
    box-shadow: var(--shadow-lg);
  }

  /* Drag Handle */
  .drag-handle {
    cursor: grab;
    color: var(--color-gray-400);
    font-size: 1.5rem;
    padding: var(--space-2);
    margin: calc(var(--space-2) * -1);
    transition: color var(--transition-base);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .drag-handle:hover {
    color: var(--color-gray-600);
  }

  .drag-handle:active {
    cursor: grabbing;
  }

  /* Main Content Area */
  .menu-card-main {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .menu-card-title-row {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .menu-card-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-gray-900);
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .menu-card-meta {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex-wrap: wrap;
    font-size: var(--text-sm);
    color: var(--color-gray-600);
  }

  .menu-card-description {
    color: var(--color-gray-600);
  }

  .meta-separator {
    color: var(--color-gray-300);
    font-weight: bold;
  }

  .stat-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    color: var(--color-gray-600);
    white-space: nowrap;
  }

  /* Actions Section */
  .menu-card-actions {
    display: flex;
    gap: var(--space-2);
    flex-shrink: 0;
    align-items: center;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .menu-card {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-3);
    }

    .drag-handle {
      align-self: flex-start;
    }

    .menu-card-actions {
      width: 100%;
      justify-content: stretch;
      align-items: stretch;
    }

    .menu-card-actions .flex-fill {
      flex: 1;
    }

    .menu-card-meta {
      gap: var(--space-1);
    }
  }

  @media (max-width: 480px) {
    .menu-card {
      padding: var(--space-3);
    }

    .menu-card-title {
      font-size: var(--text-base);
    }

    .menu-card-meta {
      font-size: var(--text-xs);
    }
  }

  /* Mobile Card Actions - Better spacing */
  @media (max-width: 480px) {
    .menu-card-actions {
      padding: var(--space-2) var(--space-3);
      gap: var(--space-1);
      align-items: stretch;
    }

    .menu-card-actions .btn {
      padding: 0.625rem 0.875rem; /* enlarge tap target */
      font-size: var(--text-sm);
      min-height: 44px; /* iOS recommended min tap height */
      width: 100%;
    }

    /* Make drag handle a bit larger for easier grab on mobile */
    .drag-handle {
      font-size: 1.75rem;
      padding: var(--space-1) var(--space-2);
      margin: 0;
    }

    /* Hide long descriptions on very small screens */
    .menu-card-description {
      display: none;
    }

    /* Keep meta compact */
    .stat-badge {
      font-size: var(--text-xs);
    }

    /* Keep status badge aligned to top on mobile */
    .menu-status-badge {
      align-self: flex-start;
      margin-bottom: 0.25rem;
    }
  }

  /* Filter Tabs - Mobile Scrollable */
  @media (max-width: 768px) {
    .nav-tabs {
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
    }

    .nav-tabs .nav-item {
      flex-shrink: 0;
    }

    .nav-tabs::-webkit-scrollbar {
      height: 3px;
    }

    .nav-tabs::-webkit-scrollbar-thumb {
      background: var(--color-gray-300);
      border-radius: 3px;
    }
  }
</style>
