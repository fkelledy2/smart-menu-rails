<%# Restaurants list frame (filters + cards) %>
<% restaurants = local_assigns[:restaurants] || @restaurants %>
<% filter = local_assigns[:filter] || 'all' %>
<% q = local_assigns[:q] || @q %>
<% counts = local_assigns[:counts] || @counts || {} %>
<% page = local_assigns[:page] || @page || 1 %>
<% per_page = local_assigns[:per_page] || @per_page || 20 %>
<% total_pages = local_assigns[:total_pages] || @total_pages || 1 %>

<!-- Filter Tabs -->
<ul class="nav nav-tabs mb-4">
  <li class="nav-item">
    <%= link_to restaurants_path(filter: 'all', q: q),
        class: "nav-link #{'active' if filter == 'all'}",
        data: { turbo_frame: 'restaurants_content', turbo_action: 'advance', testid: 'restaurants-filter-all' } do %>
      <%= t('.all', default: 'All') %>
      <span class="badge bg-secondary ms-1"><%= counts[:all] %></span>
    <% end %>
  </li>
  <li class="nav-item">
    <%= link_to restaurants_path(filter: 'active', q: q),
        class: "nav-link #{'active' if filter == 'active'}",
        data: { turbo_frame: 'restaurants_content', turbo_action: 'advance', testid: 'restaurants-filter-active' } do %>
      <%= t('.active', default: 'Active') %>
      <span class="badge bg-success ms-1"><%= counts[:active] %></span>
    <% end %>
  </li>
  <li class="nav-item">
    <%= link_to restaurants_path(filter: 'inactive', q: q),
        class: "nav-link #{'active' if filter == 'inactive'}",
        data: { turbo_frame: 'restaurants_content', turbo_action: 'advance', testid: 'restaurants-filter-inactive' } do %>
      <%= t('.inactive', default: 'Inactive') %>
      <span class="badge bg-warning text-dark ms-1"><%= counts[:inactive] %></span>
    <% end %>
  </li>
  <li class="nav-item">
    <%= link_to restaurants_path(filter: 'archived', q: q),
        class: "nav-link #{'active' if filter == 'archived'}",
        data: { turbo_frame: 'restaurants_content', turbo_action: 'advance', testid: 'restaurants-filter-archived' } do %>
      <%= t('.archived', default: 'Archived') %>
      <span class="badge bg-secondary ms-1"><%= counts[:archived] %></span>
    <% end %>
  </li>
</ul>

<!-- Restaurants Cards -->
<div class="menus-list" data-testid="restaurants-list">
  <% if restaurants.blank? %>
    <div class="text-center py-5">
      <i class="bi bi-shop text-muted" style="font-size:2rem;"></i>
      <h4 class="mt-2 text-muted"><%= t('.no_restaurants', default: 'No restaurants found') %></h4>
      <% if q.present? %>
        <p class="text-muted"><%= t('.no_results_for', default: 'No results for') %> "<%= q %>"</p>
        <%= link_to t('.clear_search', default: 'Clear search'), restaurants_path(filter: filter), class: 'btn btn-sm btn-outline-secondary', data: { turbo_frame: 'restaurants_content' } %>
      <% end %>
    </div>
  <% end %>
  <% restaurants.each do |restaurant| %>
    <div class="menu-card" data-testid="restaurant-card-<%= restaurant.id %>">
      <div class="menu-card-main">
        <div class="menu-card-title-row">
          <h3 class="menu-card-title"><%= restaurant.name %></h3>
          <%# status badge %>
          <% if restaurant.status_before_type_cast == 1 %>
            <span class="badge bg-success"><i class="bi bi-check-circle"></i> <%= t('.active', default: 'Active') %></span>
          <% elsif restaurant.status_before_type_cast == 0 %>
            <span class="badge bg-warning text-dark"><i class="bi bi-pause"></i> <%= t('.inactive', default: 'Inactive') %></span>
          <% else %>
            <span class="badge bg-secondary"><i class="bi bi-archive"></i> <%= t('.archived', default: 'Archived') %></span>
          <% end %>
        </div>

<!-- Pagination -->
<% if total_pages.to_i > 1 %>
  <nav class="mt-3" aria-label="Restaurants pagination">
    <ul class="pagination mb-0">
      <% prev_page = page.to_i - 1 %>
      <li class="page-item <%= 'disabled' if prev_page < 1 %>">
        <%= link_to '&laquo;'.html_safe, restaurants_path(filter: filter, q: q, page: prev_page, per: per_page), class: 'page-link', data: { turbo_frame: 'restaurants_content', turbo_action: 'advance' } %>
      </li>
      <% (1..total_pages).each do |p| %>
        <li class="page-item <%= 'active' if p == page.to_i %>">
          <%= link_to p, restaurants_path(filter: filter, q: q, page: p, per: per_page), class: 'page-link', data: { turbo_frame: 'restaurants_content', turbo_action: 'advance' } %>
        </li>
      <% end %>
      <% next_page = page.to_i + 1 %>
      <li class="page-item <%= 'disabled' if next_page > total_pages.to_i %>">
        <%= link_to '&raquo;'.html_safe, restaurants_path(filter: filter, q: q, page: next_page, per: per_page), class: 'page-link', data: { turbo_frame: 'restaurants_content', turbo_action: 'advance' } %>
      </li>
    </ul>
  </nav>
<% end %>

        <div class="menu-card-meta">
          <span class="stat-badge"><i class="bi bi-menu-button-wide"></i> <%= restaurant.menus.count %> <%= t('.menus', default: 'menus') %></span>
          <span class="meta-separator">â€¢</span>
          <span class="stat-badge"><i class="bi bi-people"></i> <%= restaurant.employees.count %> <%= t('.staff', default: 'staff') %></span>
        </div>
      </div>

      <div class="menu-card-actions ms-auto">
        <div class="dropdown">
          <button class="btn-2025 btn-2025-ghost btn-2025-sm"
                  type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  data-testid="restaurant-actions-<%= restaurant.id %>-btn">
            <i class="bi bi-three-dots-vertical"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <%= link_to edit_restaurant_path(restaurant), class: 'dropdown-item', data: { turbo_frame: '_top', testid: "edit-restaurant-#{restaurant.id}-btn" } do %>
                <i class="bi bi-pencil"></i> <%= t('.edit', default: 'Edit') %>
              <% end %>
            </li>
            <li>
              <%= link_to edit_restaurant_path(restaurant, section: 'menus'), class: 'dropdown-item', data: { turbo_frame: '_top', testid: "restaurant-menus-#{restaurant.id}-btn" } do %>
                <i class="bi bi-menu-button-wide"></i> <%= t('.menus', default: 'Menus') %>
              <% end %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  <% end %>
</div>

<style>
  .menus-list { display:flex; flex-direction:column; gap: var(--space-3); }
  .menu-card { display:flex; align-items:center; gap: var(--space-4); background:#fff; border:1px solid var(--color-gray-200); border-radius: var(--radius-lg); padding: var(--space-4); }
  .menu-card-title { font-size: var(--text-lg); font-weight: var(--font-semibold); margin:0; }
  .menu-card-title-row { display:flex; align-items:center; gap: var(--space-3); flex-wrap:wrap; }
  .menu-card-meta { display:flex; align-items:center; gap: var(--space-2); flex-wrap:wrap; font-size: var(--text-sm); color: var(--color-gray-600); }
  .stat-badge { display:inline-flex; align-items:center; gap: var(--space-1); }
  .meta-separator { color: var(--color-gray-300); font-weight:bold; }
  .menu-card-actions { display:flex; gap: var(--space-2); }
  @media (max-width: 768px){ .menu-card{ flex-direction:column; align-items:stretch;} .menu-card-actions{ width:100%; } }
</style>
