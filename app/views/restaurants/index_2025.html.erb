<%# 2025 Restaurants Index - Cards + Tabs with Turbo Frame %>
<% content_for :title, t('.title', default: 'Your Restaurants') %>

<div class="container-fluid px-0 py-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
    <div>
      <h1 class="text-2xl fw-semibold mb-1"><%= t('.heading', default: 'Restaurants') %></h1>
      <p class="text-muted mb-0"><%= t('.subtitle', default: 'Manage locations, menus and staff') %></p>
    </div>
  </div>

  <!-- Quick Actions Card -->
  <div class="quick-actions-card mb-4" data-testid="restaurants-quick-actions">
    <h2 class="quick-actions-title">
      <i class="bi bi-lightning-charge"></i>
      <%= t('.quick_actions', default: 'Quick Actions') %>
    </h2>

    <div class="quick-actions-grid">
      <% if @canAddRestaurant %>
        <%= link_to new_restaurant_path,
            class: 'quick-action-btn',
            data: { turbo_frame: 'new_restaurant_modal', bs_toggle: 'modal', bs_target: '#newRestaurantModal', testid: 'new-restaurant-btn' } do %>
          <i class="bi bi-plus-circle"></i>
          <span><%= t('.new_restaurant', default: 'New Restaurant') %></span>
        <% end %>
      <% else %>
        <a class="quick-action-btn disabled"
           title="Your plan limit has been reached. Upgrade your plan or archive an existing restaurant to add a new one."
           aria-disabled="true"
           data-controller="disabled-action"
           data-action="click->disabled-action#explain"
           data-disabled-action-title-value="Restaurant limit reached"
           data-disabled-action-message-value="Your plan limit has been reached. Upgrade your plan or archive an existing restaurant to add a new one."
           data-testid="new-restaurant-btn">
          <i class="bi bi-plus-circle"></i>
          <span><%= t('.new_restaurant', default: 'New Restaurant') %></span>
        </a>
      <% end %>
    </div>
  </div>

  <%= turbo_frame_tag 'restaurants_content' do %>
    <%= render 'restaurants/index_frame_2025', restaurants: @restaurants, filter: @filter, q: @q, counts: @counts %>
  <% end %>

  <div class="modal fade" id="newRestaurantModal" tabindex="-1" aria-labelledby="newRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl new-restaurant-modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="newRestaurantModalLabel"><%= t('.new_restaurant', default: 'New Restaurant') %></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="<%= t('common.close', default: 'Close') %>"></button>
        </div>
        <div class="modal-body">
          <%= turbo_frame_tag 'new_restaurant_modal', src: new_restaurant_path do %>
            <div class="text-muted"><%= t('common.loading', default: 'Loadingâ€¦') %></div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
