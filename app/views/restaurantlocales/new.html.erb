<%#
  New Restaurant Locale - 2025 Design System
  Modern form layout with consistent styling
%>

<% in_frame = defined?(turbo_frame_request?) && turbo_frame_request? %>

<!-- Page Header (hidden when rendering inside a Turbo Frame) -->
<% unless in_frame %>
  <div class="container-fluid px-0 pb-4">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
      <div>
        <!-- Breadcrumb -->
        <div class="text-sm text-gray-500 mb-2">
          <%= link_to @restaurantlocale.restaurant.name, edit_restaurant_path(@restaurantlocale.restaurant), class: 'text-primary' %>
          <i class="bi bi-chevron-right"></i>
          <%= link_to t('.settings', default: 'Settings'), edit_restaurant_path(@restaurantlocale.restaurant, section: 'settings'), class: 'text-primary' %>
          <i class="bi bi-chevron-right"></i>
          <%= t('.new_locale', default: 'New Language') %>
        </div>

        <h1 class="text-2xl font-semibold text-gray-900 mb-1">
          <i class="bi bi-plus-circle"></i>
          <%= t('.add_locale', default: 'Add Language') %>
        </h1>
        <p class="text-sm text-gray-500">
          <%= t('.description', default: 'Add a new language for your restaurant') %>
        </p>
      </div>

      <div class="d-flex gap-2">
        <%= link_to edit_restaurant_path(@restaurantlocale.restaurant, section: 'settings'),
            class: 'btn-2025 btn-2025-ghost btn-2025-md' do %>
          <i class="bi bi-arrow-left"></i> <%= t('.back', default: 'Back to Settings') %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<!-- Form Card (wrapped in Turbo Frame for inline rendering) -->
<%= turbo_frame_tag 'localization_new_locale' do %>
  <div class="content-card-2025" data-skip-form-manager="true">
    <h2 class="content-card-title">
      <i class="bi bi-globe"></i>
      <%= t('.locale_details', default: 'Language Details') %>
    </h2>

    <%= render 'form', restaurantlocale: @restaurantlocale %>
  </div>
<% end %>

<script>
  // Prevent TomSelect initialization on this form
  function preventTomSelect() {
    const form = document.querySelector('[data-skip-form-manager]');
    if (form) {
      form.querySelectorAll('select, input[type="checkbox"], input[type="hidden"]').forEach(el => {
        el.setAttribute('data-skip-tomselect', 'true');
        // Also destroy any existing TomSelect instances
        if (el.tomselect) {
          el.tomselect.destroy();
        }
      });
    }
  }

  // Run on initial load
  document.addEventListener('DOMContentLoaded', preventTomSelect);
  // Run on Turbo navigation
  document.addEventListener('turbo:load', preventTomSelect);
  // Run immediately in case we're already loaded
  preventTomSelect();
</script>

<style>
  .text-2xl {
    font-size: 1.5rem;
    line-height: 2rem;
  }

  .text-gray-900 {
    color: var(--color-gray-900);
  }

  .text-gray-500 {
    color: var(--color-gray-500);
  }

  .text-sm {
    font-size: 0.875rem;
  }
</style>
