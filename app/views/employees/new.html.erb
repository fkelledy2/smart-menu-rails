<%= render 'shared/customcss' %>

<% in_frame = defined?(turbo_frame_request?) && turbo_frame_request? %>

<% unless in_frame %>
  <div class="page-header">
    <div class="row">
      <div class="col-12">
        <h4>
          <%= link_to edit_restaurant_path(@employee.restaurant), class: "link-dark" do %>
            <%= @employee.restaurant.name %>
          <% end %>
        </h4>
      </div>
    </div>
  </div>
  <ul class="nav-tabs-height nav nav-tabs overflow-auto flex-nowrap" id="enployeeTabsBack" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link link-dark">
        <%= link_to edit_restaurant_path(@employee.restaurant), class: "link-dark" do %>
          <strong><i class="bi bi-lg bi-chevron-double-left"></i></strong>
        <% end %>
      </button>
    </li>
  </ul>
  <p>
<% end %>

<%= turbo_frame_tag 'staff_new_employee' do %>
  <div class="content-card-2025" data-skip-form-manager="true">
    <h2 class="content-card-title">
      <i class="bi bi-person-plus"></i>
      New Staff
    </h2>

    <%= render 'form', employee: @employee %>
  </div>

  <script>
    (function() {
      function syncEmployeeSaveDisabledState() {
        var frame = document.getElementById('staff_new_employee');
        if (!frame) return;

        var form = frame.querySelector('form');
        if (!form) return;

        var saveBtn = form.querySelector('[data-disable-until-valid="true"]');
        if (!saveBtn) return;

        var isValid = true;
        try {
          isValid = form.checkValidity();
        } catch (e) {
          isValid = true;
        }

        saveBtn.disabled = !isValid;
      }

      document.addEventListener('input', function(e) {
        if (!e.target) return;
        if (e.target.closest && e.target.closest('#staff_new_employee')) {
          syncEmployeeSaveDisabledState();
        }
      });

      document.addEventListener('change', function(e) {
        if (!e.target) return;
        if (e.target.closest && e.target.closest('#staff_new_employee')) {
          syncEmployeeSaveDisabledState();
        }
      });

      syncEmployeeSaveDisabledState();
    })();
  </script>
<% end %>
