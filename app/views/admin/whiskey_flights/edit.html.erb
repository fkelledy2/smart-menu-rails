<h1>Edit Whiskey Flight — <%= @flight.title %></h1>

<%= form_with url: admin_whiskey_flight_restaurant_path(@restaurant, flight_id: @flight.id), method: :patch, local: true do |f| %>
  <div class="mb-3">
    <label for="whiskey_flight_title" class="form-label">Title</label>
    <input type="text" name="whiskey_flight[title]" id="whiskey_flight_title" class="form-control"
           value="<%= @flight.title %>" required>
  </div>

  <div class="mb-3">
    <label for="whiskey_flight_narrative" class="form-label">Narrative</label>
    <textarea name="whiskey_flight[narrative]" id="whiskey_flight_narrative" class="form-control"
              rows="3"><%= @flight.narrative %></textarea>
  </div>

  <% existing_ids = @flight.items.map { |i| i['menuitem_id'] } %>
  <div class="mb-3">
    <label class="form-label">Select 3 Whiskeys</label>
    <% @whiskey_items.each do |item| %>
      <% item_data = @flight.items.find { |i| i['menuitem_id'] == item.id } %>
      <div class="form-check">
        <input type="checkbox" name="whiskey_flight[item_ids][]" value="<%= item.id %>"
               id="item_<%= item.id %>" class="form-check-input"
               <%= 'checked' if existing_ids.include?(item.id) %>>
        <label for="item_<%= item.id %>" class="form-check-label">
          <%= item.name %> (<%= number_to_currency(item.price) %>)
        </label>
        <input type="text" name="whiskey_flight[item_notes][]" placeholder="Tasting note…"
               value="<%= item_data&.dig('note') %>"
               class="form-control form-control-sm mt-1" style="max-width: 400px;">
      </div>
    <% end %>
  </div>

  <div class="mb-3">
    <label for="whiskey_flight_custom_price" class="form-label">Custom Flight Price (optional)</label>
    <input type="number" step="0.01" name="whiskey_flight[custom_price]"
           id="whiskey_flight_custom_price" class="form-control" style="max-width: 200px;"
           value="<%= @flight.custom_price %>">
  </div>

  <%= f.submit 'Update Flight', class: 'btn btn-primary' %>
  <%= link_to 'Cancel', admin_whiskey_flights_restaurant_path(@restaurant), class: 'btn btn-outline-secondary ms-2' %>
<% end %>
