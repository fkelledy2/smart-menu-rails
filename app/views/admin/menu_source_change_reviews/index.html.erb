<div class="container">
  <h2>Change Detection Queue</h2>

  <%= form_with url: admin_menu_source_change_reviews_path, method: :get, local: true do %>
    <div class="row g-2 align-items-end">
      <div class="col-md-3">
        <%= label_tag :status, 'Status' %>
        <%= select_tag :status,
              options_for_select([['All', '']] + MenuSourceChangeReview.statuses.keys.map { |k| [k.humanize, k] }, @status),
              class: 'form-select' %>
      </div>
      <div class="col-md-2">
        <%= submit_tag 'Filter', class: 'btn btn-primary w-100' %>
      </div>
    </div>
  <% end %>

  <div class="mt-3">
    <table class="table table-sm table-striped">
      <thead>
        <tr>
          <th>Detected</th>
          <th>Status</th>
          <th>Source</th>
          <th>Restaurant</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @reviews.each do |r| %>
          <tr>
            <td><%= r.detected_at.strftime('%Y-%m-%d %H:%M') %></td>
            <td><%= r.status %></td>
            <td><%= link_to r.menu_source.source_url, admin_menu_source_change_review_path(r) %></td>
            <td>
              <% if r.menu_source.restaurant %>
                <%= r.menu_source.restaurant.name %>
              <% elsif r.menu_source.discovered_restaurant %>
                <%= r.menu_source.discovered_restaurant.name %>
              <% end %>
            </td>
            <td class="text-end">
              <%= button_to 'Resolve', resolve_admin_menu_source_change_review_path(r), method: :patch, class: 'btn btn-sm btn-success' %>
              <%= button_to 'Ignore', ignore_admin_menu_source_change_review_path(r), method: :patch, class: 'btn btn-sm btn-secondary' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
