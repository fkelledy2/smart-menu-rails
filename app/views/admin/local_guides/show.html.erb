<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><%= @local_guide.title %></h1>
    <div>
      <%= link_to 'Edit', edit_admin_local_guide_path(@local_guide), class: 'btn btn-outline-dark me-2' %>
      <%= link_to 'Back', admin_local_guides_path, class: 'btn btn-outline-secondary' %>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-8">
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between">
          <span>Guide Content</span>
          <% badge_class = { 'draft' => 'bg-warning', 'published' => 'bg-success', 'archived' => 'bg-secondary' }[@local_guide.status] || 'bg-light' %>
          <span class="badge <%= badge_class %>"><%= @local_guide.status.titleize %></span>
        </div>
        <div class="card-body">
          <%= @local_guide.content.html_safe %>
        </div>
      </div>

      <% if @local_guide.faq_data.present? && @local_guide.faq_data.any? %>
        <div class="card mb-3">
          <div class="card-header">FAQ</div>
          <div class="card-body">
            <% @local_guide.faq_data.each do |faq| %>
              <h6><%= faq['question'] %></h6>
              <p class="text-muted"><%= faq['answer'] %></p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="col-md-4">
      <div class="card mb-3">
        <div class="card-header">Details</div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item"><strong>City:</strong> <%= @local_guide.city %></li>
          <li class="list-group-item"><strong>Country:</strong> <%= @local_guide.country %></li>
          <li class="list-group-item"><strong>Category:</strong> <%= @local_guide.category || '—' %></li>
          <li class="list-group-item"><strong>Slug:</strong> <code><%= @local_guide.slug %></code></li>
          <li class="list-group-item"><strong>Published:</strong> <%= @local_guide.published_at&.strftime('%Y-%m-%d %H:%M') || '—' %></li>
          <li class="list-group-item"><strong>Regenerated:</strong> <%= @local_guide.regenerated_at&.strftime('%Y-%m-%d %H:%M') || '—' %></li>
          <li class="list-group-item"><strong>Approved by:</strong> <%= @local_guide.approved_by_user&.email || '—' %></li>
        </ul>
      </div>

      <% if @local_guide.referenced_restaurants.present? && @local_guide.referenced_restaurants.any? %>
        <div class="card mb-3">
          <div class="card-header">Referenced Restaurants</div>
          <ul class="list-group list-group-flush">
            <% @local_guide.referenced_restaurants.each do |ref| %>
              <li class="list-group-item"><%= ref['name'] || ref[:name] %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="card">
        <div class="card-header">Actions</div>
        <div class="card-body d-grid gap-2">
          <% if @local_guide.draft? %>
            <%= button_to 'Approve & Publish', approve_admin_local_guide_path(@local_guide), method: :patch, class: 'btn btn-success' %>
          <% end %>
          <% unless @local_guide.archived? %>
            <%= button_to 'Archive', archive_admin_local_guide_path(@local_guide), method: :patch, class: 'btn btn-outline-warning' %>
          <% end %>
          <%= button_to 'Regenerate Content', regenerate_admin_local_guide_path(@local_guide), method: :post, class: 'btn btn-outline-primary' %>
          <%= button_to 'Delete', admin_local_guide_path(@local_guide), method: :delete, class: 'btn btn-outline-danger', data: { turbo_confirm: 'Are you sure?' } %>
        </div>
      </div>
    </div>
  </div>
</div>
