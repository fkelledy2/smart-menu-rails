
<!DOCTYPE html>
<html class="h-100">
<style>
    ::-webkit-scrollbar {
        height: 0px;
        width: 4px;
        border: 1px solid #d5d5d5;
    }
    .form-control:disabled {
        background-color: #fafafa;
        opacity: 1;
    }
    .tabulator-row-odd {
        background-color: #ffffff !important;
    }
    .tabulator-row-even {
        background-color: #ffffff !important;
    }
    .disabled .ts-control {
        opacity: 1.0;
        background-color: #fafafa;
    }
    .ts-dropdown, .ts-control, .ts-control input {
        color: #000000;
        padding-left:12px;
        font-size: 16px;
        line-height: 18px;
    }
</style>

  <head>
    <%= render 'shared/head' %>
    <%= Sentry.get_trace_propagation_meta.html_safe %>
    <%= tag.link rel: "manifest", href: "/manifest.json" %>
    
    <!-- 1. Load jQuery first -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" 
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
            crossorigin="anonymous"></script>
    
    <!-- 2. Load Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" 
          crossorigin="anonymous">
    
    <!-- 3. Application CSS -->
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    
    <!-- 4. Load Bootstrap JS with a script that ensures it's globally available -->
    <script>
      // This will hold our reference to Bootstrap
      window.bootstrap = null;
      
      // Function to initialize Bootstrap
      function initializeBootstrap() {
        // If Bootstrap is already loaded, use it
        if (window.bootstrap) return;
        
        // Create a script element to load Bootstrap
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
        script.integrity = 'sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz';
        script.crossOrigin = 'anonymous';
        
        script.onload = function() {
          // Store Bootstrap in our global variable
          window.bootstrap = bootstrap;
          console.log('Bootstrap loaded successfully');
          
          // Dispatch an event that Bootstrap is ready
          const event = new Event('bootstrap:ready');
          document.dispatchEvent(event);
        };
        
        script.onerror = function() {
          console.error('Failed to load Bootstrap');
        };
        
        document.head.appendChild(script);
      }
      
      // Start loading Bootstrap immediately
      initializeBootstrap();
      
      // Helper function to safely use Bootstrap components
      window.safeBootstrap = function(componentName, method, selector, options = {}) {
        const initComponent = function() {
          if (!window.bootstrap || !window.bootstrap[componentName]) {
            // If Bootstrap isn't loaded yet, wait for it
            document.addEventListener('bootstrap:ready', function onReady() {
              document.removeEventListener('bootstrap:ready', onReady);
              safeBootstrap(componentName, method, selector, options);
            });
            return;
          }
          
          const elements = document.querySelectorAll(selector);
          elements.forEach(element => {
            try {
              if (!element) return;
              
              const instance = bootstrap[componentName].getInstance(element) || 
                             new bootstrap[componentName](element, options);
              
              if (instance && method && typeof instance[method] === 'function') {
                instance[method]();
              }
            } catch (e) {
              console.error(`Error initializing Bootstrap ${componentName}:`, e);
            }
          });
        };
        
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initComponent);
        } else {
          initComponent();
        }
      };
    </script>
    
    <!-- 5. Importmap and other scripts -->
    <%= javascript_importmap_tags %>
  </head>

  <body style='overflow-x: hidden;' class="d-flex flex-column min-vh-100" data-session-id="<%= session.id %>">
    <div style=' display: flex;min-height: 100vh;flex-direction: column;justify-content: space-between;'>
      <div style='padding-left:0px;padding-right:0px;' class="container-fluid">
        <main class="flex-wrapper">
          <%= render 'shared/navbar' %>
          <div class="container-fluid mx-auto">
                <div style="height:5px"></div>
                <%= yield %>
          </div>
        </main>
      </div>
      <%= render 'shared/footer' %>
    </div>
  </body>
</html>
