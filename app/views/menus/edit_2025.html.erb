<%# 
  2025 Menu Edit Page
  Modern sidebar navigation for menu management
  Applies same pattern as Restaurant Edit page
%>

<% content_for :title, @menu.name %>

<div data-controller="sidebar">
  <!-- Page Header -->
  <div class="container-fluid px-4 py-4 bg-white border-bottom">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <!-- Breadcrumb -->
        <div class="text-sm text-gray-500 mb-2">
          <%= link_to @menu.restaurant.name, 
              edit_restaurant_path(@menu.restaurant), 
              class: 'text-primary' %>
          <i class="bi bi-chevron-right"></i>
          <%= t('.menus', default: 'Menus') %>
        </div>
        
        <h1 class="text-2xl font-semibold text-gray-900 mb-1">
          <%= @menu.name %>
        </h1>
        
        <div class="d-flex align-items-center gap-3 mt-2">
          <!-- Status Badge -->
          <% if @menu.active? %>
            <span class="badge bg-success">
              <i class="bi bi-check-circle"></i> <%= t('.active', default: 'Active') %>
            </span>
          <% else %>
            <span class="badge bg-warning text-dark">
              <i class="bi bi-pencil"></i> <%= t('.inactive', default: 'Inactive') %>
            </span>
          <% end %>
          
          <!-- Quick Stats -->
          <span class="text-sm text-gray-500">
            <%= @menu.menusections.count %> <%= t('.sections', default: 'sections') %>
          </span>
          <span class="text-sm text-gray-500">
            <%= @menu.menuitems.count %> <%= t('.items', default: 'items') %>
          </span>
        </div>
      </div>
      
      <div class="d-flex gap-2 align-items-center">
        <!-- Mobile Sidebar Toggle -->
        <button class="sidebar-toggle-btn" 
                data-action="click->sidebar#toggle"
                aria-label="Toggle navigation">
          <i class="bi bi-list"></i>
        </button>
      
        <!-- Quick Actions -->
        <% if @menu.smartmenu&.slug %>
          <%= link_to smartmenu_path(@menu.smartmenu.slug), 
              class: 'btn-2025 btn-2025-secondary btn-2025-md',
              target: '_blank' do %>
            <i class="bi bi-eye"></i> <%= t('.preview', default: 'Preview Menu') %>
          <% end %>
        <% end %>
        
        <div class="dropdown">
          <button class="btn-2025 btn-2025-ghost btn-2025-md" 
                  type="button" 
                  data-bs-toggle="dropdown" 
                  aria-expanded="false">
            <i class="bi bi-three-dots-vertical"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <%= link_to '#', class: 'dropdown-item' do %>
                <i class="bi bi-files"></i> <%= t('.duplicate', default: 'Duplicate Menu') %>
              <% end %>
            </li>
            <li>
              <%= link_to '#', class: 'dropdown-item' do %>
                <i class="bi bi-download"></i> <%= t('.export', default: 'Export Data') %>
              <% end %>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <%= link_to restaurant_menu_path(@menu.restaurant, @menu), 
                  method: :delete,
                  data: { confirm: t('.confirm_delete', default: 'Delete this menu?') },
                  class: 'dropdown-item text-danger' do %>
                <i class="bi bi-trash"></i> <%= t('.delete', default: 'Delete Menu') %>
              <% end %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar + Content Layout -->
  <div class="sidebar-content-container">
    <!-- Sidebar Navigation -->
    <%= render 'menus/sidebar_2025', 
        menu: @menu, 
        current_section: @current_section %>
    
    <!-- Main Content Area -->
    <div class="sidebar-main-content">
      <%= turbo_frame_tag 'menu_content' do %>
        <% 
          partial_name = case @current_section
                        when 'design' then 'design_2025'
                        when 'sections' then 'sections_2025'
                        when 'items' then 'items_2025'
                        when 'schedule' then 'schedule_2025'
                        when 'qrcode' then 'qrcode_2025'
                        else 'details_2025'
                        end
        %>
        <%= render "menus/sections/#{partial_name}", menu: @menu %>
      <% end %>
    </div>
  </div>
</div>

<% content_for :head do %>
  <style>
    /* Page-specific styles */
    body {
      background: var(--color-gray-50);
    }
    
    .text-2xl {
      font-size: 1.5rem;
      line-height: 2rem;
    }
    
    .text-gray-900 {
      color: var(--color-gray-900);
    }
    
    .text-gray-500 {
      color: var(--color-gray-500);
    }
  </style>
<% end %>
