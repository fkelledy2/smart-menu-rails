<%#
  Menu Design Section
  Images, PDF uploads, and visual settings
%>

<% menu = local_assigns[:menu] || @menu %>
<% restaurant = local_assigns[:restaurant] || @restaurant || menu.restaurant %>

<% menu_smartmenu_slug = Smartmenu.where(restaurant_id: restaurant.id, menu_id: menu.id, tablesetting_id: nil).first&.slug %>

<!-- Quick Actions Card -->
<div class="mb-3 p-3">
  <h2 class="quick-actions-title">
    <i class="bi bi-lightning-charge"></i>
    <%= t('.quick_actions') %>
  </h2>

  <div class="quick-actions-grid">
    <%= button_to regenerate_images_restaurant_menu_path(restaurant, menu, generate_ai: true),
        method: :post,
        class: 'quick-action-btn',
        data: { turbo: false, ai_generate: true, menu_id: menu.id } do %>
      <i class="bi bi-stars"></i>
      <span><%= t('.generate_images') %></span>
    <% end %>

    <% if menu_smartmenu_slug.present? %>
      <%= link_to smartmenu_path(menu_smartmenu_slug),
          class: 'quick-action-btn',
          target: '_blank',
          title: t('.preview_staff_title') do %>
        <i class="bi bi-eye"></i>
        <span><%= t('.preview_staff') %></span>
      <% end %>

      <%= link_to smartmenu_path(menu_smartmenu_slug, view: 'customer'),
          class: 'quick-action-btn quick-action-btn-secondary',
          target: '_blank',
          rel: 'noopener noreferrer',
          title: t('.preview_customer_title') do %>
        <i class="bi bi-eye-slash"></i>
        <span><%= t('.preview_customer') %></span>
      <% end %>
    <% end %>
  </div>
</div>

<% if false %>
<!-- Menu Image -->
<div class="content-card-2025">
  <h2 class="content-card-title">
    <i class="bi bi-image"></i>
    <%= t('.menu_image') %>
  </h2>

  <%= menu_form_with(menu, auto_save: true) do |form| %>
    <div class="row g-4">
      <% if menu.image.present? %>
        <div class="col-md-12">
          <div class="image-preview">
            <%= image_tag menu.image_url, class: 'img-fluid rounded' %>
          </div>
        </div>
      <% end %>

      <div class="col-md-12">
        <div class="form-group-2025">
          <%= form.label :image, class: 'form-label-2025' do %>
            <%= t('.upload_image') %>
          <% end %>
          <%= form.hidden_field :image, value: form.object.cached_image_data, id: nil %>
          <%= form.file_field :image, class: 'form-control-2025' %>
          <div class="form-help-2025">
            <%= t('.image_help') %>
          </div>
        </div>
      </div>

      <% if menu.image.present? %>
        <div class="col-md-12">
          <div class="form-check">
            <%= form.check_box :remove_image, class: 'form-check-input' %>
            <%= form.label :remove_image, t('.remove_image'), class: 'form-check-label' %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
<% end %>

<% if false %>
<!-- PDF Menu -->
<div class="content-card-2025">
  <h2 class="content-card-title">
    <i class="bi bi-file-pdf"></i>
    <%= t('.pdf_menu') %>
  </h2>

  <p class="text-muted mb-4">
    <%= t('.pdf_menu_desc') %>
  </p>

  <%= menu_form_with(menu, auto_save: true) do |form| %>
    <div class="row g-4">
      <% if menu.pdf_menu_scan.attached? %>
        <div class="col-md-12">
          <div class="pdf-preview">
            <i class="bi bi-file-pdf text-danger text-3rem"></i>
            <div class="ms-3">
              <strong><%= menu.pdf_menu_scan.filename %></strong>
              <div class="text-sm text-muted">
                <%= number_to_human_size(menu.pdf_menu_scan.byte_size) %>
              </div>
              <%= link_to rails_blob_path(menu.pdf_menu_scan, disposition: "attachment"),
                  target: "_blank",
                  class: 'btn btn-sm btn-outline-secondary mt-2' do %>
                <i class="bi bi-download"></i> <%= t('.download') %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <div class="col-md-12">
        <div class="form-group-2025">
          <%= form.label :pdf_menu_scan, class: 'form-label-2025' do %>
            <%= t('.upload_pdf') %>
          <% end %>
          <%= form.file_field :pdf_menu_scan,
              class: 'form-control-2025',
              accept: 'application/pdf' %>
          <div class="form-help-2025">
            <%= t('.pdf_help') %>
          </div>
        </div>
      </div>

      <% if menu.pdf_menu_scan.attached? %>
        <div class="col-md-12">
          <div class="form-check">
            <%= check_box_tag 'menu[remove_pdf_menu_scan]', '1', false, class: 'form-check-input' %>
            <%= label_tag 'menu[remove_pdf_menu_scan]', t('.remove_pdf'), class: 'form-check-label' %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
<% end %>

<!-- Display Settings -->
<div class="mb-3 p-3">
  <h2 class="content-card-title">
    <i class="bi bi-sliders"></i>
    <%= t('.display_settings') %>
  </h2>

  <%= menu_form_with(menu, auto_save: true) do |form| %>
    <div class="features-grid">
      <!-- Show Images -->
      <div class="feature-card">
        <div class="feature-card-icon bg-primary">
          <i class="bi bi-image"></i>
        </div>
        <div class="feature-card-content">
          <h5 class="feature-card-title"><%= t('.show_images') %></h5>
          <p class="feature-card-description">
            <%= t('.show_images_desc') %>
          </p>
        </div>
        <div class="feature-card-toggle">
          <div class="form-check form-switch">
            <input type="hidden" name="menu[displayImages]" value="false">
            <input class="form-check-input"
                   type="checkbox"
                   name="menu[displayImages]"
                   id="menu_displayImages_toggle"
                   value="true"
                   <%= 'checked' if menu.displayImages %>
                   data-skip-tomselect="true">
          </div>
        </div>
      </div>

      <!-- Popup Images -->
      <div class="feature-card">
        <div class="feature-card-icon bg-success">
          <i class="bi bi-window-stack"></i>
        </div>
        <div class="feature-card-content">
          <h5 class="feature-card-title"><%= t('.popup_images') %></h5>
          <p class="feature-card-description">
            <%= t('.popup_images_desc') %>
          </p>
        </div>
        <div class="feature-card-toggle">
          <div class="form-check form-switch">
            <input type="hidden" name="menu[displayImagesInPopup]" value="false">
            <input class="form-check-input"
                   type="checkbox"
                   name="menu[displayImagesInPopup]"
                   id="menu_displayImagesInPopup_toggle"
                   value="true"
                   <%= 'checked' if menu.displayImagesInPopup %>
                   data-skip-tomselect="true">
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<style>
  .image-preview {
    max-width: 600px;
    margin-bottom: var(--space-4);
  }

  .pdf-preview {
    display: flex;
    align-items: center;
    padding: var(--space-4);
    background: var(--color-gray-50);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
  }

  /* Feature Grid Layout */
  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-4);
  }

  .feature-card {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    padding: var(--space-4);
    background: white;
    border: 2px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    transition: all var(--transition-base);
  }

  .feature-card:hover {
    border-color: var(--color-gray-300);
    box-shadow: var(--shadow-sm);
  }

  .feature-card-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .feature-card-content {
    flex: 1;
  }

  .feature-card-title {
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    margin: 0 0 var(--space-2) 0;
    color: var(--color-gray-900);
  }

  .feature-card-description {
    font-size: var(--text-sm);
    color: var(--color-gray-600);
    margin: 0;
    line-height: 1.5;
  }

  .feature-card-toggle {
    padding-top: var(--space-2);
    border-top: 1px solid var(--color-gray-100);
  }

  .feature-card-toggle .form-switch {
    display: flex;
    justify-content: flex-end;
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .features-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
