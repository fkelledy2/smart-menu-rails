<%#
  Menu Sidebar Navigation - 2025 UI
  Menu Configuration
  Groups menu management into 3 logical sections
%>

<%# Calculate counts for badges %>
<%
  menu = local_assigns[:menu] || @menu
  restaurant = local_assigns[:restaurant] || @restaurant || menu.restaurant
  sections_count = local_assigns[:sections_count] || (@_menu_sections_count ||= (menu.menusections.count rescue 0))
  items_count = local_assigns[:items_count] || (@_menu_items_count ||= (menu.menuitems.count rescue 0))
  schedules_count = local_assigns[:schedules_count] || (@_menu_schedules_count ||= (menu.menuavailabilities.count rescue 0))
  current_section = local_assigns[:current_section] || 'details'

  # Super-admin visibility: determine if user has natural access or is here only via super_admin bypass
  is_super_admin = current_user&.super_admin?
  has_natural_access = (restaurant.user_id == current_user&.id) ||
                       current_user&.admin_employee_for_restaurant?(restaurant.id)
  super_admin_only_access = is_super_admin && !has_natural_access
  sa_badge = super_admin_only_access ? content_tag(:span, '(*)', class: 'sidebar-sa-badge', title: t('common.super_admin_only_tooltip'), data: { bs_toggle: 'tooltip', bs_placement: 'right' }) : nil
%>

<aside class="sidebar-2025" data-sidebar-target="sidebar">
  <!-- Mobile Header -->
  <div class="sidebar-header">
    <h3><%= menu.name %></h3>
    <button data-action="click->sidebar#close" aria-label="Close menu">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <!-- MENU SECTION -->
  <div class="sidebar-section">
    <div class="sidebar-section-title">
      <i class="bi bi-file-text"></i>
      <%= t('.menu', default: 'MENU') %>
    </div>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'details'),
        class: "sidebar-link #{'active' if current_section == 'details'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-info-circle"></i>
      <span><%= t('.details', default: 'Details') %></span>
      <%= sa_badge %>
    <% end %>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'schedule'),
        class: "sidebar-link #{'active' if current_section == 'schedule'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-calendar-check"></i>
      <span><%= t('.schedule', default: 'Schedule') %></span>
      <% if schedules_count > 0 %>
        <span class="sidebar-link-badge"><%= schedules_count %></span>
      <% end %>
      <%= sa_badge %>
    <% end %>
  </div>

  <!-- CONTENT SECTION -->
  <div class="sidebar-section">
    <div class="sidebar-section-title">
      <i class="bi bi-grid-3x3-gap"></i>
      <%= t('.content', default: 'CONTENT') %>
    </div>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'sections'),
        class: "sidebar-link #{'active' if current_section == 'sections'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-layout-text-sidebar"></i>
      <span><%= t('.sections', default: 'Sections') %></span>
      <% if sections_count > 0 %>
        <span class="sidebar-link-badge"><%= sections_count %></span>
      <% end %>
      <%= sa_badge %>
    <% end %>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'items'),
        class: "sidebar-link #{'active' if current_section == 'items'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-list-ul"></i>
      <span><%= t('.items', default: 'Items') %></span>
      <% if items_count > 0 %>
        <span class="sidebar-link-badge"><%= items_count %></span>
      <% end %>
      <%= sa_badge %>
    <% end %>
  </div>

  <!-- SETUP SECTION -->
  <div class="sidebar-section">
    <div class="sidebar-section-title">
      <i class="bi bi-gear"></i>
      <%= t('.setup', default: 'SETUP') %>
    </div>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'settings'),
        class: "sidebar-link #{'active' if current_section == 'settings'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-toggles"></i>
      <span><%= t('.settings', default: 'Settings') %></span>
      <%= sa_badge %>
    <% end %>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'qrcode'),
        class: "sidebar-link #{'active' if current_section == 'qrcode'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-qr-code"></i>
      <span><%= t('.qrcode', default: 'QR Code') %></span>
      <%= sa_badge %>
    <% end %>

    <%= link_to edit_restaurant_menu_path(restaurant, menu, section: 'versions'),
        class: "sidebar-link #{'active' if current_section == 'versions'}",
        data: { turbo_frame: 'menu_content', turbo_action: 'advance', action: 'click->sidebar#handleLinkClick' } do %>
      <i class="bi bi-clock-history"></i>
      <span><%= t('.versions', default: 'Versions') %></span>
      <%= sa_badge %>
    <% end %>
  </div>
</aside>

<!-- Mobile Overlay -->
<div class="sidebar-overlay" data-sidebar-target="overlay" data-action="click->sidebar#close"></div>
