<%#
  2025 Menu Item Edit Page
  Modern design aligned with menu edit page
%>

<% content_for :title, @menuitem.name %>

<!-- Page Header -->
<div class="container-fluid px-0 py-4 bg-white border-bottom sticky-header">
  <div class="container-2025">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <!-- Breadcrumb -->
        <div class="text-sm text-gray-500 mb-2">
          <%= link_to @menuitem.menusection.menu.restaurant.name,
              edit_restaurant_path(@menuitem.menusection.menu.restaurant),
              class: 'text-primary' %>
          <i class="bi bi-chevron-right"></i>
          <%= link_to @menuitem.menusection.menu.name,
              edit_restaurant_menu_path(@menuitem.menusection.menu.restaurant, @menuitem.menusection.menu, section: 'items'),
              class: 'text-primary' %>
          <i class="bi bi-chevron-right"></i>
          <%= t('.menu_item', default: 'Menu Item') %>
        </div>

        <h1 class="text-2xl font-semibold text-gray-900 mb-1">
          <%= @menuitem.name %>
        </h1>

        <div class="d-flex align-items-center gap-3 mt-2">
          <!-- Section Badge -->
          <span class="badge bg-secondary">
            <i class="bi bi-layout-text-sidebar"></i> <%= @menuitem.menusection.name %>
          </span>
        </div>
      </div>

      <div class="d-flex gap-2 align-items-center">
        <!-- Back Button -->
        <%= link_to edit_restaurant_menu_path(@menuitem.menusection.menu.restaurant, @menuitem.menusection.menu, section: 'items'),
            class: 'btn btn-outline-secondary' do %>
          <i class="bi bi-arrow-left"></i> <%= t('.back_to_items', default: 'Back to Items') %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container-2025 py-4">
  <%= render 'form', menuitem: @menuitem %>
</div>

<div data-controller="ai-image-generator">
  <div class="modal fade z-index-7000" id="menuitemAiImageModal" tabindex="-1" aria-hidden="true"
       data-ai-image-generator-target="modal"
       data-action="hidden.bs.modal->ai-image-generator#dismiss">
    <div class="modal-dialog ai-bottom-sheet z-index-7001 position-fixed bottom-0 left-0 right-0 m-0 width-full max-width-100">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Generate Image</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div data-ai-image-generator-target="confirmPane">
            <p>This will generate a new AI image for this menu item and may consume API credits. AI Polish (and an image prompt) is strongly recommended first. Proceed?</p>
          </div>
          <div data-ai-image-generator-target="progressPane" class="d-none">
            <div class="mb-2">
              <div class="small text-muted">Status:</div>
              <div data-ai-image-generator-target="progressText" class="fw-semibold">Queuedâ€¦</div>
            </div>
            <div class="progress">
              <div data-ai-image-generator-target="progressBar" class="progress-bar" role="progressbar" style="width: 15%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <div class="mt-3 d-none" data-ai-image-generator-target="preview">
              <div class="small text-muted mb-2">Image preview:</div>
              <img data-ai-image-generator-target="previewImg" src="" alt="Generated menu item image" class="img-fluid w-100 rounded border" />
            </div>
          </div>
        </div>
        <div class="modal-footer gap-2">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"><%= t('common.cancel', default: 'Cancel') %></button>
          <button type="button"
                  data-ai-image-generator-target="confirmBtn"
                  data-action="click->ai-image-generator#confirm"
                  class="btn btn-primary">Confirm & Start</button>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :head do %>
  <style>
    /* Page-specific styles */
    body {
      background: var(--color-gray-50);
    }

    .container-2025 {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--space-4);
    }

    .text-2xl {
      font-size: 1.5rem;
      line-height: 2rem;
    }

    .text-gray-900 {
      color: var(--color-gray-900);
    }

    .text-gray-500 {
      color: var(--color-gray-500);
    }

    .text-sm {
      font-size: var(--text-sm);
    }
  </style>
<% end %>
