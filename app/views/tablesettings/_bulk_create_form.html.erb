<% restaurant = local_assigns[:restaurant] %>
<% error = local_assigns[:error] %>

<div class="content-card-2025" data-skip-form-manager="true">
  <h2 class="content-card-title">
    <i class="bi bi-lightning-charge"></i>
    <%= t('.title', default: 'Bulk Create Tables') %>
  </h2>

  <% if error.present? %>
    <div class="alert alert-danger mb-3">
      <i class="bi bi-exclamation-triangle"></i>
      <%= error %>
    </div>
  <% end %>

  <%= form_with url: bulk_create_restaurant_tablesettings_path(restaurant), method: :post, data: { turbo_frame: 'tables_bulk_create' } do |f| %>
    <div class="row g-3">
      <div class="col-6 col-md-3">
        <label class="form-label fw-semibold" for="bulk_prefix">
          <i class="bi bi-type"></i>
          <%= t('.prefix', default: 'Prefix') %>
        </label>
        <%= f.text_field :prefix, value: 'T', class: 'form-control', id: 'bulk_prefix', placeholder: 'T', maxlength: 1 %>
        <div class="form-text"><%= t('.prefix_hint', default: 'e.g. T, B or leave blank') %></div>
      </div>

      <div class="col-6 col-md-3">
        <label class="form-label fw-semibold" for="bulk_count">
          <i class="bi bi-hash"></i>
          <%= t('.count', default: 'How many') %>
        </label>
        <%= f.number_field :count, value: 10, class: 'form-control', id: 'bulk_count', min: 1, max: 200, required: true %>
        <div class="form-text"><%= t('.count_hint', default: 'Max 200') %></div>
      </div>

      <div class="col-6 col-md-3">
        <label class="form-label fw-semibold" for="bulk_tabletype">
          <i class="bi bi-house"></i>
          <%= t('.table_type', default: 'Type') %>
        </label>
        <%= f.select :tabletype,
            [
              [t('.indoor', default: 'Indoor'), 'indoor'],
              [t('.outdoor', default: 'Outdoor'), 'outdoor'],
            ],
            {},
            { class: 'form-select', id: 'bulk_tabletype' } %>
      </div>

      <div class="col-6 col-md-3">
        <label class="form-label fw-semibold" for="bulk_capacity">
          <i class="bi bi-people"></i>
          <%= t('.capacity', default: 'Capacity') %>
        </label>
        <%= f.number_field :capacity, value: 1, class: 'form-control', id: 'bulk_capacity', min: 1, max: 100 %>
      </div>
    </div>

    <%
      # Auto-detect preview: show the next start number for the default prefix
      existing_numbers = restaurant.tablesettings
        .where(archived: false)
        .where('name LIKE ?', 'T%')
        .pluck(:name)
        .filter_map { |n| n.delete_prefix('T').to_i if n.start_with?('T') && n.delete_prefix('T').match?(/\A\d+\z/) }
      next_start = (existing_numbers.max || 0) + 1
    %>
    <div class="mt-3 text-muted small">
      <i class="bi bi-info-circle"></i>
      <%= t('.auto_detect_hint', default: 'Tables will be numbered automatically. Next available: %{example}', example: "T#{next_start}") %>
    </div>

    <div class="d-flex gap-2 mt-3">
      <%= f.submit t('.create_tables', default: 'Create Tables'), class: 'btn btn-primary' %>
      <%= link_to t('.cancel', default: 'Cancel'),
          edit_restaurant_path(restaurant, section: 'tables'),
          class: 'btn btn-outline-secondary',
          data: { turbo_frame: 'tables_bulk_create' } %>
    </div>
  <% end %>
</div>
