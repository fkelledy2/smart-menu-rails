<div class="wizard-form mx-auto">
  <div class="text-center mb-5">
    <h1 class="h2 mb-3"><%= t('onboarding.restaurant_details.title') %></h1>
    <p class="text-muted"><%= t('onboarding.restaurant_details.subtitle') %></p>
  </div>

  <%= form_with model: @onboarding, url: onboarding_path, method: :patch, local: true, 
                data: { step: 2 }, class: "needs-validation", novalidate: true do |f| %>
    
    <div class="mb-4">
      <%= f.label :restaurant_name, t('onboarding.restaurant_details.restaurant_name_label'), class: "form-label" %>
      <%= f.text_field :restaurant_name, 
          class: "form-control form-control-lg", 
          placeholder: t('onboarding.restaurant_details.restaurant_name_placeholder'),
          required: true %>
      <div class="invalid-feedback">
        <%= t('onboarding.restaurant_details.restaurant_name_required') %>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-6">
        <%= f.label :restaurant_type, t('onboarding.restaurant_details.restaurant_type_label'), class: "form-label" %>
        <%= f.select :restaurant_type, 
            options_for_select([
              [t('onboarding.restaurant_details.restaurant_types.fine_dining'), 'fine_dining'],
              [t('onboarding.restaurant_details.restaurant_types.casual_dining'), 'casual_dining'],
              [t('onboarding.restaurant_details.restaurant_types.fast_casual'), 'fast_casual'],
              [t('onboarding.restaurant_details.restaurant_types.quick_service'), 'quick_service'],
              [t('onboarding.restaurant_details.restaurant_types.cafe'), 'cafe'],
              [t('onboarding.restaurant_details.restaurant_types.bar_grill'), 'bar_grill'],
              [t('onboarding.restaurant_details.restaurant_types.food_truck'), 'food_truck'],
              [t('onboarding.restaurant_details.restaurant_types.bakery'), 'bakery'],
              [t('onboarding.restaurant_details.restaurant_types.other'), 'other']
            ], @onboarding&.restaurant_type),
            { prompt: t('onboarding.restaurant_details.restaurant_type_prompt') },
            { class: "form-select form-select-lg", required: true } %>
        <div class="invalid-feedback">
          <%= t('onboarding.restaurant_details.restaurant_type_required') %>
        </div>
      </div>
      
      <div class="col-md-6">
        <%= f.label :cuisine_type, t('onboarding.restaurant_details.cuisine_type_label'), class: "form-label" %>
        <%= f.select :cuisine_type, 
            options_for_select([
              [t('onboarding.restaurant_details.cuisine_types.american'), 'american'],
              [t('onboarding.restaurant_details.cuisine_types.italian'), 'italian'],
              [t('onboarding.restaurant_details.cuisine_types.mexican'), 'mexican'],
              [t('onboarding.restaurant_details.cuisine_types.chinese'), 'chinese'],
              [t('onboarding.restaurant_details.cuisine_types.japanese'), 'japanese'],
              [t('onboarding.restaurant_details.cuisine_types.indian'), 'indian'],
              [t('onboarding.restaurant_details.cuisine_types.french'), 'french'],
              [t('onboarding.restaurant_details.cuisine_types.mediterranean'), 'mediterranean'],
              [t('onboarding.restaurant_details.cuisine_types.thai'), 'thai'],
              [t('onboarding.restaurant_details.cuisine_types.greek'), 'greek'],
              [t('onboarding.restaurant_details.cuisine_types.spanish'), 'spanish'],
              [t('onboarding.restaurant_details.cuisine_types.korean'), 'korean'],
              [t('onboarding.restaurant_details.cuisine_types.vietnamese'), 'vietnamese'],
              [t('onboarding.restaurant_details.cuisine_types.middle_eastern'), 'middle_eastern'],
              [t('onboarding.restaurant_details.cuisine_types.fusion'), 'fusion'],
              [t('onboarding.restaurant_details.cuisine_types.other'), 'other']
            ], @onboarding&.cuisine_type),
            { prompt: t('onboarding.restaurant_details.cuisine_type_prompt') },
            { class: "form-select form-select-lg", required: true } %>
        <div class="invalid-feedback">
          <%= t('onboarding.restaurant_details.cuisine_type_required') %>
        </div>
      </div>
    </div>

    <div class="mb-4">
      <%= f.label :location, t('onboarding.restaurant_details.location_label'), class: "form-label" %>
      <%= f.text_field :location, 
          class: "form-control form-control-lg", 
          placeholder: t('onboarding.restaurant_details.location_placeholder'),
          required: true %>
      <div class="form-text"><%= t('onboarding.restaurant_details.location_help') %></div>
      <div class="invalid-feedback">
        <%= t('onboarding.restaurant_details.location_required') %>
      </div>
    </div>

    <div class="mb-4">
      <%= f.label :phone, t('onboarding.restaurant_details.phone_label'), class: "form-label" %>
      <%= f.telephone_field :phone, 
          class: "form-control form-control-lg", 
          placeholder: t('onboarding.restaurant_details.phone_placeholder') %>
      <div class="form-text"><%= t('onboarding.restaurant_details.phone_help') %></div>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-5">
      <%= link_to onboarding_step_path(1), class: "btn btn-outline-secondary btn-lg btn-wizard" do %>
        <i class="fas fa-arrow-left me-2"></i>
        <%= t('onboarding.restaurant_details.back') %>
      <% end %>
      
      <button type="submit" class="btn btn-primary btn-lg btn-wizard">
        <%= t('onboarding.restaurant_details.continue') %>
        <i class="fas fa-arrow-right ms-2"></i>
      </button>
    </div>
  <% end %>
</div>

<!-- Tips section -->
<div class="mt-5">
  <div class="alert alert-info">
    <h6 class="alert-heading">
      <i class="fas fa-lightbulb me-2"></i>
      <%= t('onboarding.restaurant_details.pro_tips.title') %>
    </h6>
    <ul class="mb-0 small">
      <li><%= t('onboarding.restaurant_details.pro_tips.tip1') %></li>
      <li><%= t('onboarding.restaurant_details.pro_tips.tip2') %></li>
      <li><%= t('onboarding.restaurant_details.pro_tips.tip3') %></li>
    </ul>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Form validation
  const form = document.querySelector('.needs-validation');
  
  form.addEventListener('submit', function(event) {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    form.classList.add('was-validated');
  });
  
  // Load restaurant name from preview if available
  const restaurantNameInput = document.querySelector('#onboarding_session_restaurant_name');
  const previewName = sessionStorage.getItem('restaurant_name_preview');
  
  if (restaurantNameInput && previewName && !restaurantNameInput.value) {
    restaurantNameInput.value = previewName;
  }
  
  // Auto-format phone number
  const phoneInput = document.querySelector('#onboarding_session_phone');
  if (phoneInput) {
    phoneInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length >= 6) {
        value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
      } else if (value.length >= 3) {
        value = value.replace(/(\d{3})(\d{3})/, '($1) $2');
      }
      e.target.value = value;
    });
  }
});
</script>
