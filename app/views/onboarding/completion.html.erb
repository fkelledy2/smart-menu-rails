<div class="text-center">
  <div class="mb-5">
    <div class="display-1 text-success mb-4">
      <i class="fas fa-check-circle"></i>
    </div>
    <h1 class="h2 mb-3">Congratulations! ðŸŽ‰</h1>
    <p class="lead text-muted">Your restaurant is now set up and ready to serve customers!</p>
  </div>

  <div class="row justify-content-center mb-5">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h5 class="card-title mb-4">
            <i class="fas fa-qrcode text-primary me-2"></i>
            Your Digital Menu is Ready
          </h5>
          
          <div class="row align-items-center">
            <div class="col-md-6">
              <div class="qr-code-placeholder bg-light d-flex align-items-center justify-content-center" 
                   style="height: 200px; border-radius: 8px;">
                <div class="text-center">
                  <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Generating QR code...</span>
                  </div>
                  <p class="mb-0 text-muted">Generating your QR code...</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h6 class="mb-3">What's happening now:</h6>
              <ul class="list-unstyled">
                <li class="mb-2">
                  <i class="fas fa-cog fa-spin text-primary me-2"></i>
                  Creating your restaurant profile
                </li>
                <li class="mb-2">
                  <i class="fas fa-cog fa-spin text-primary me-2"></i>
                  Setting up your menu
                </li>
                <li class="mb-2">
                  <i class="fas fa-cog fa-spin text-primary me-2"></i>
                  Generating QR codes
                </li>
                <li class="mb-2">
                  <i class="fas fa-cog fa-spin text-primary me-2"></i>
                  Configuring payment options
                </li>
              </ul>
              
              <div class="alert alert-info mt-3">
                <small>
                  <i class="fas fa-info-circle me-1"></i>
                  This usually takes 30-60 seconds. You'll be redirected automatically when complete.
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Next steps preview -->
  <div class="row justify-content-center mb-5">
    <div class="col-lg-10">
      <h5 class="mb-4">What's next?</h5>
      <div class="row g-4">
        <div class="col-md-4">
          <div class="card h-100 border-0 bg-light">
            <div class="card-body text-center">
              <i class="fas fa-edit text-primary fs-1 mb-3"></i>
              <h6>Customize Your Menu</h6>
              <p class="small text-muted mb-0">Add more items, upload photos, and set detailed descriptions</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card h-100 border-0 bg-light">
            <div class="card-body text-center">
              <i class="fas fa-print text-success fs-1 mb-3"></i>
              <h6>Print QR Codes</h6>
              <p class="small text-muted mb-0">Download and print QR codes for your tables</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card h-100 border-0 bg-light">
            <div class="card-body text-center">
              <i class="fas fa-chart-line text-info fs-1 mb-3"></i>
              <h6>Track Orders</h6>
              <p class="small text-muted mb-0">Monitor customer orders and analytics in real-time</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Success stats -->
  <div class="row text-center mb-5">
    <div class="col-md-4">
      <div class="display-6 text-success fw-bold">âœ“</div>
      <h6>Restaurant Created</h6>
      <small class="text-muted"><%= @onboarding&.restaurant_name || 'Your Restaurant' %></small>
    </div>
    <div class="col-md-4">
      <div class="display-6 text-success fw-bold">âœ“</div>
      <h6>Menu Published</h6>
      <small class="text-muted"><%= @onboarding&.menu_name || 'Main Menu' %></small>
    </div>
    <div class="col-md-4">
      <div class="display-6 text-success fw-bold">âœ“</div>
      <h6>Plan Activated</h6>
      <small class="text-muted">14-day free trial</small>
    </div>
  </div>

  <!-- CTA buttons -->
  <div class="d-flex flex-column flex-md-row gap-3 justify-content-center">
    <button class="btn btn-primary btn-lg" id="go-to-dashboard" disabled>
      <i class="fas fa-tachometer-alt me-2"></i>
      Go to Dashboard
    </button>
    <button class="btn btn-outline-primary btn-lg" id="view-menu" disabled>
      <i class="fas fa-eye me-2"></i>
      View Live Menu
    </button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let checkCount = 0;
  const maxChecks = 30; // 30 seconds maximum wait
  
  // Check completion status
  function checkCompletion() {
    checkCount++;
    
    fetch('/onboarding', {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.completed) {
        showSuccess(data);
      } else if (checkCount < maxChecks) {
        setTimeout(checkCompletion, 2000); // Check every 2 seconds
      } else {
        showTimeout();
      }
    })
    .catch(error => {
      console.error('Error checking completion:', error);
      if (checkCount < maxChecks) {
        setTimeout(checkCompletion, 2000);
      } else {
        showTimeout();
      }
    });
  }
  
  function showSuccess(data) {
    // Update QR code
    const qrPlaceholder = document.querySelector('.qr-code-placeholder');
    if (data.qr_code_url) {
      qrPlaceholder.innerHTML = `
        <img src="${data.qr_code_url}" alt="QR Code" class="img-fluid" style="max-width: 180px;">
      `;
    } else {
      qrPlaceholder.innerHTML = `
        <div class="text-center">
          <i class="fas fa-qrcode text-success" style="font-size: 4rem;"></i>
          <p class="mb-0 text-success mt-2">QR Code Ready!</p>
        </div>
      `;
    }
    
    // Update status indicators
    document.querySelectorAll('.fa-cog').forEach(icon => {
      icon.classList.remove('fa-cog', 'fa-spin');
      icon.classList.add('fa-check');
      icon.style.color = '#28a745';
    });
    
    // Enable buttons
    const dashboardBtn = document.getElementById('go-to-dashboard');
    const menuBtn = document.getElementById('view-menu');
    
    dashboardBtn.disabled = false;
    menuBtn.disabled = false;
    
    if (data.dashboard_url) {
      dashboardBtn.onclick = () => window.location.href = data.dashboard_url;
    } else {
      dashboardBtn.onclick = () => window.location.href = '/';
    }
    
    if (data.menu_url) {
      menuBtn.onclick = () => window.open(data.menu_url, '_blank');
    }
    
    // Show success animation
    confetti({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  }
  
  function showTimeout() {
    const qrPlaceholder = document.querySelector('.qr-code-placeholder');
    qrPlaceholder.innerHTML = `
      <div class="text-center">
        <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
        <p class="mb-0 text-warning mt-2">Setup taking longer than expected</p>
        <small class="text-muted">Please refresh the page or contact support</small>
      </div>
    `;
    
    // Enable dashboard button anyway
    const dashboardBtn = document.getElementById('go-to-dashboard');
    dashboardBtn.disabled = false;
    dashboardBtn.onclick = () => window.location.href = '/';
  }
  
  // Start checking after 2 seconds
  setTimeout(checkCompletion, 2000);
  
  // Animate the progress indicators
  let currentStep = 0;
  const steps = document.querySelectorAll('.fa-cog');
  
  function animateSteps() {
    if (currentStep < steps.length) {
      steps[currentStep].style.color = '#007bff';
      currentStep++;
      setTimeout(animateSteps, 1000);
    }
  }
  
  animateSteps();
});

// Confetti function (simple fallback if library not available)
function confetti(options) {
  if (typeof window.confetti === 'function') {
    window.confetti(options);
  } else {
    // Simple celebration without library
    console.log('ðŸŽ‰ Celebration! Setup complete!');
  }
}
</script>
