<div class="wizard-form mx-auto">
  <div class="text-center mb-5">
    <h1 class="h2 mb-3"><%= t('onboarding.account_details.title') %></h1>
    <p class="text-muted"><%= t('onboarding.account_details.subtitle') %></p>
  </div>

  <%= form_with model: current_user, url: onboarding_path, method: :patch, local: true,
                data: { step: 1 }, class: "needs-validation", novalidate: true do |f| %>
    <%= hidden_field_tag :step, 1 %>

    <div class="mb-4">
      <%= f.label :name, t('onboarding.account_details.full_name_label'), class: "form-label" %>
      <%= f.text_field :name,
          class: "form-control form-control-lg",
          placeholder: t('onboarding.account_details.full_name_placeholder'),
          required: true,
          autocomplete: "name",
          value: current_user.name %>
      <div class="invalid-feedback">
        <%= t('onboarding.account_details.full_name_required') %>
      </div>
    </div>

    <div class="mb-4">
      <label class="form-label"><%= t('onboarding.account_details.email_label') %></label>
      <input type="email" class="form-control form-control-lg"
             value="<%= current_user.email %>"
             autocomplete="email"
             disabled>
      <div class="form-text"><%= t('onboarding.account_details.email_help') %></div>
    </div>

    <div class="mb-4">
      <%= label_tag 'onboarding_session[restaurant_name]', t('onboarding.account_details.restaurant_name_preview_label'), class: "form-label" %>
      <%= text_field_tag 'onboarding_session[restaurant_name]',
          @onboarding&.restaurant_name,
          class: "form-control form-control-lg",
          placeholder: t('onboarding.account_details.restaurant_name_preview_placeholder'),
          required: true,
          autocomplete: "organization",
          data: { testid: 'restaurant-name' } %>
      <div class="form-text"><%= t('onboarding.account_details.restaurant_name_preview_help') %></div>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-5">
      <div>
        <!-- No back button on first step -->
      </div>

      <button type="submit" class="btn btn-primary btn-lg btn-wizard" id="continue-btn" disabled>
        <%= t('onboarding.account_details.continue') %>
        <i class="fas fa-arrow-right ms-2" aria-hidden="true"></i>
      </button>
    </div>
  <% end %>
</div>

<!-- Stats sidebar content -->
<div class="row mt-5">
  <div class="col-md-4">
    <div class="text-center">
      <div class="display-6 text-primary fw-bold"><%= t('onboarding.account_details.stats.restaurants_count') %></div>
      <div class="text-muted"><%= t('onboarding.account_details.stats.restaurants_label') %></div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="text-center">
      <div class="display-6 text-success fw-bold"><%= t('onboarding.account_details.stats.setup_time') %></div>
      <div class="text-muted"><%= t('onboarding.account_details.stats.setup_time_label') %></div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="text-center">
      <div class="display-6 text-info fw-bold"><%= t('onboarding.account_details.stats.satisfaction') %></div>
      <div class="text-muted"><%= t('onboarding.account_details.stats.satisfaction_label') %></div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Form validation
  const form = document.querySelector('.needs-validation');

  form.addEventListener('submit', function(event) {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    form.classList.add('was-validated');
  });

  // Gate continue until both user name and restaurant name are present
  const continueBtn = document.getElementById('continue-btn');
  const nameInput = document.querySelector('input[name="user[name]"]');
  const restaurantInput = document.querySelector('input[name="onboarding_session[restaurant_name]"]');

  function updateContinueState() {
    const nameOk = nameInput && nameInput.value.trim().length > 0;
    const restaurantOk = restaurantInput && restaurantInput.value.trim().length > 0;
    continueBtn.disabled = !(nameOk && restaurantOk);
  }

  [nameInput, restaurantInput].forEach(function(el) {
    if (el) {
      el.addEventListener('input', updateContinueState);
      el.addEventListener('change', updateContinueState);
    }
  });

  updateContinueState();
});
</script>
