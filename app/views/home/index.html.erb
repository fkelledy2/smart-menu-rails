<style>
    ::-webkit-scrollbar {
        height: 0px;
        width: 4px;
        border: 1px solid #d5d5d5;
    }
    .form-control:disabled {
        background-color: #fafafa;
        opacity: 1;
    }
    .tabulator-row-odd {
        background-color: #ffffff !important;
    }
    .tabulator-row-even {
        background-color: #ffffff !important;
    }
    .disabled .ts-control {
        opacity: 1.0;
        background-color: #fafafa;
    }
    .ts-dropdown, .ts-control, .ts-control input {
        border: 0px;
        color: #000000;
        padding-left:12px;
        font-size: 16px;
        line-height: 18px;
    }
</style>

<% if current_user %>

    <div class="row">
      <% if @current_user.plan == nil %>
        <div class="col-lg-4 offset-lg-4">
                <br>
                <br>
                <br>
                <h1 class="text-center"><%= t(".welcome").html_safe %></h1>
                <br>
                <h2 class="text-center"><%= t(".selectPlan").html_safe %></h2>
                <br>
                <%= form_with(model: @userplan) do |f| %>
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1"><%= f.label :plan %></span>
                    <%= f.select :plan_id, options_for_select(Plan.all.collect { |p| [t(p.key), p.id] }), {}, { class: 'form-select'} %>
                    <%= f.hidden_field :user_id, value: @current_user.id %>
                  </div>
                  <div class="mb-3 d-grid">
                    <%= f.submit t(".saveChanges"), class: 'btn btn-lg btn-danger' %>
                  </div>
                <% end %>
          </div>

      <% else %>
          <div class="col-6">
            <h4><%= t(".restaurants") %> </h4>
          </div>
          <div class="col-6 text-end">
            <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
              <div class="btn-group" role="group">
                <button id="restaurant-actions" type="button" class="btn btn-dark dropdown-toggle" disabled data-bs-toggle="dropdown" aria-expanded="false">
                  <%= t('common.actions') %>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="allergyn-actions">
                  <li><a id="activate-restaurant" class="dropdown-item" href="#"><%= t('common.activate') %></a></li>
                  <li><a id="deactivate-restaurant" class="dropdown-item" href="#"><%= t('common.deactivate') %></a></li>
                </ul>
              </div>
              <% if @canAddRestaurant == true %>
                  <button type="button" class="btn btn-dark">
                    <%= link_to new_restaurant_path, class: 'link-light' do %>
                      <i class="bi bi-plus"></i>
                    <% end %>
                  </button>
              <% end %>
            </div>
          </div>
        </div>
        <div class="table-container table-borderless" id="restaurant-table">
        </div>
      <% end %>
<% else %>
  <div class="hero-carousel"
       data-cta1-title="<%= t('.ctaTitle1') %>"
       data-cta1-body="<%= t('.ctaBody1') %>"
       data-cta2-title="<%= t('.ctaTitle2') %>"
       data-cta2-body="<%= t('.ctaBody2') %>"
       data-hero-images="<%= @hero_images.map { |img| { url: img.image_url, alt: img.alt_text } }.to_json %>">
    <!-- Background images will be dynamically inserted by JavaScript -->
    <div class="hero-caption text-start">
      <h1 data-cta-title><%= t(".ctaTitle1") %></h1>
      <p data-cta-body><strong><%= t(".ctaBody1") %></strong></p>
      <p><%= link_to t(".signUp"), new_user_registration_path, class: "btn btn-danger" %></p>
    </div>
  </div>
  </div>

  <div class="container px-1 py-2">
    <h2 class="pb-2 border-bottom"><%= t(".features") %></h2>
    <div class="row g-4 py-3 px-3 row-cols-1 row-cols-lg-3">
      <div class="col d-flex align-items-start feature-card">
        <div class="icon-square text-body-emphasis d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
            <h2><i class="feature-icon bi bi-activity"></i></h2>
        </div>
        <div>
          <h3 class="fs-2 text-body-emphasis"><%= t(".featureTitle2").html_safe %></h3>
          <p class="feature-description"><%= t(".featureDescription2").html_safe %></p>
        </div>
      </div>
      <div class="col d-flex align-items-start feature-card">
        <div class="icon-square text-body-emphasis d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
            <h2><i class="feature-icon bi bi-bullseye"></i></h2>
        </div>
        <div>
          <h3 class="fs-2 text-body-emphasis"><%= t(".featureTitle3").html_safe %></h3>
          <p class="feature-description"><%= t(".featureDescription3").html_safe %></p>
        </div>
      </div>
      <div class="col d-flex align-items-start feature-card">
        <div class="icon-square text-body-emphasis d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
            <h2><i class="feature-icon bi bi-emoji-heart-eyes"></i></h2>
        </div>
        <div>
          <h3 class="fs-2 text-body-emphasis"><%= t(".featureTitle4").html_safe %></h3>
          <p class="feature-description"><%= t(".featureDescription4").html_safe %></p>
        </div>
      </div>
      <div class="col d-flex align-items-start feature-card">
        <div class="icon-square text-body-emphasis d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
            <h2><i class="feature-icon bi bi-graph-up-arrow"></i></h2>
        </div>
        <div>
          <h3 class="fs-2 text-body-emphasis"><%= t(".featureTitle6").html_safe %></h3>
          <p class="feature-description"><%= t(".featureDescription6").html_safe %></p>
        </div>
      </div>
      <div class="col d-flex align-items-start feature-card">
        <div class="icon-square text-body-emphasis d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
            <h2><i class="feature-icon bi bi-tree"></i></h2>
        </div>
        <div>
          <h3 class="fs-2 text-body-emphasis"><%= t(".featureTitle5").html_safe %></h3>
          <p class="feature-description"><%= t(".featureDescription5").html_safe %></p>
        </div>
      </div>
    </div>
  </div>

  <% if @demoMenu %>
    <span class="display-none" id="qrIcon"><%= image_url('qr-icon.svg') %></span>
    <span class="display-none" id="qrHost"><%= @qrHost %></span>
    <div class="container px-1 py-2">
        <h2 class="pb-2 border-bottom"><%= t(".demoMenu") %></h2>
        <div id="demo-table" class="container px-1 py-2">
          <div class="row g-4 py-2 row-cols-12 row-cols-12 row-cols-lg-12 align-items-center">
                <span class="display-none qrSlug"><%= @demoMenu.slug %></span>
                <div class="padding-horizontal-2 col-sm-12 col-md-12 col-lg-8">
                  <div class="embed-responsive embed-responsive-16by9">
                        <video style='z-index:10000;' width="100%" loop muted playsinline autoplay>
                          <source src="<%= asset_path('smart-menu.mp4') %>" type="video/mp4">
                          <%= t('.video_unsupported') %>
                        </video>
                  </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-4">
                    <h6 class="text-center-padded"><%= t(".demoMenuTag").html_safe %></h6>
                    <div class="d-flex justify-content-center">
                        <a href="<%= smartmenu_path(@demoMenu.slug) %>" target="_blank">
                            <div id="<%= @demoMenu.slug %>">
                            </div>
                        </a>
                    </div>
                    <h6 class="text-center-padded">
                        <%= t(".demoMenuTagBrowse").html_safe %>
                    </h6>
                    <h6 class="text-center">
                        <%= link_to t(".browse"), smartmenus_path, class: "btn btn-danger" %>
                    </h6>
                </div>
          </div>
        </div>
    </div>
  <% end %>

  <div id="metrics-table" class="display-none container px-1 py-2">
    <h2 class="pb-2 border-bottom"><%= t(".numbers") %></h2>
    <p class="text-justify"><%= t(".numbersTag") %></p>
    <div class="row g-4 py-5 row-cols-2 row-cols-2 row-cols-lg-4">
      <div class="col d-flex align-items-start">
        <div class="card text-center width-full">
          <div class="card-header">
            <h4 class="card-title"><%= t(".restaurants") %></h4>
          </div>
          <div class="card-body">
            <h1 class="feature-icon" id="metrics-numberOfRestaurants"></h1>
          </div>
        </div>
      </div>
      <div class="col d-flex align-items-start">
        <div class="card text-center width-full">
          <div class="card-header">
            <h4 class="card-title"><%= t(".menus") %></h4>
          </div>
          <div class="card-body">
            <h1 class="feature-icon" id="metrics-numberOfMenus"></h1>
          </div>
        </div>
      </div>
      <div class="col d-flex align-items-start">
        <div class="card text-center width-full">
          <div class="card-header">
            <h4 class="card-title"><%= t(".orders") %></h4>
          </div>
          <div class="card-body">
            <h1 class="feature-icon" id="metrics-numberOfOrders"></h1>
          </div>
        </div>
      </div>
      <div class="col d-flex align-items-start">
        <div class="card text-center width-full">
          <div class="card-header">
            <h4 class="card-title"><%= t(".orderValue") %></h4>
          </div>
          <div class="card-body">
            <h1 class="feature-icon">
                $<span id="metrics-totalOrderValue"></span>
            </h1>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container px-1 py-2">
   <h2 class="pb-2 border-bottom"><%= t(".pricing") %></h2>
   <p class="text-justify"><%= t(".pricingTag") %></p>
   <div class="row row-cols-1 row-cols-md-4 mb-3 text-center">
    <% @plans.each do |plan| %>
      <div class="col">
        <% if plan.favourite %>
         <div class="card mb-4 rounded-3 shadow-lg">
            <div class="card-header bg-danger text-white py-3 py-3">
        <% else %>
          <div class="card mb-4 rounded-3 shadow-sm">
            <div class="card-header py-3">
        <% end %>
            <h4 class="my-0 fw-normal"><%= t(plan.key) %></h4>
          </div>
          <div class="card-body">
            <div>
                <% if plan.pricePerMonth %>
                    <h1 class="card-title pricing-card-title"><i class="bi bi-currency-dollar"></i><%= number_with_precision(plan.pricePerMonth, precision: 0) %><small class="text-body-secondary fw-light">/mo</small></h1>
                <% else %>
                    <h1 class="card-title pricing-card-title"><i class="bi bi-telephone-plus-fill"></i><small class="text-body-secondary fw-light"></small></h1>
                <% end %>
            </div>
            <div class="display-none">
                <% if plan.pricePerYear %>
                    <h1 class="card-title pricing-card-title"><i class="bi bi-currency-dollar"></i><%= number_with_precision(plan.pricePerYear, precision: 0) %><small class="text-body-secondary fw-light">/yr</small></h1>
                <% else %>
                    <h1 class="card-title pricing-card-title"><%= t(".contactUs") %><small class="text-body-secondary fw-light"></small></h1>
                <% end %>
            </div>
            <div class="text-start">
            <ul class="list-unstyled mt-3 mb-4">
              <% if plan.attribute1 %>
                  <%= t_html(plan.attribute1, locations: plan.locations) %>
              <% else %>
                  <li>&nbsp</li>
              <% end %>
              <% if plan.attribute2 %>
                  <%= t_html(plan.attribute2, locations: plan.getLocations, menus: plan.getMenusPerLocation, dishes: plan.getItemsPerMenu, languages: plan.getLanguages) %>
              <% else %>
                  <li>&nbsp</li>
              <% end %>
              <% if plan.attribute3 %>
                    <hr>
                  <%= t_html(plan.attribute3, locations: plan.getLocations, menus: plan.getMenusPerLocation, dishes: plan.getItemsPerMenu, languages: plan.getLanguages) %>
              <% else %>
                  <li>&nbsp</li>
              <% end %>
            </ul>
            </div>
            <% if plan.action == 'register' %>
                <%= link_to t(".signUp"), new_user_registration_path, class: "w-100 btn btn-danger" %>
            <% else %>
                <a class="w-100 btn btn-danger" href="#contact_us"><%= t('plan.'+plan.action) %></a>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
   </div>

   <h2 class="display-none pb-2"><%= t('.compare_plans') %></h2>
   <div class="display-none table-responsive">
      <table class="table text-center">
        <thead>
          <tr>
            <th class="w-34"></th>
            <% @plans.each do |plan| %>
            <th class="w-22"><%= t(plan.key) %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @features.each do |feature| %>
          <tr>
            <th scope="row" class="text-start"><%= t(feature.key) %></th>
            <% @plans.each do |plan| %>
            <td>
                <% if FeaturesPlan.where( plan_id: plan.id, feature_id: feature.id).first %>
                    <i class="bi bi-check2"></i>
                <% end %>
            </td>
            <% end %>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
   </div>

  <% if @testimonials.size > 0 %>
      <div id="testimonials" class="container px-1 py-2">
        <h2 class="pb-2 border-bottom"><%= t(".testimonials") %></h2>
        <p class="text-justify"><%= t(".testimonialsTag") %></p>
        <div id="testimonialCarousel" class="carousel carousel-dark slide mb-6" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <% @testimonials.each_with_index do |testimonial, index| %>
                    <% if index == 0 %>
                        <button type="button" data-bs-target="#testimonialCarousel" data-bs-slide-to="<%= index %>" aria-label="" class="active" aria-current="true"></button>
                    <% else %>
                        <button type="button" data-bs-target="#testimonialCarousel" data-bs-slide-to="<%= index %>" aria-label="" class=""></button>
                    <% end %>
                <% end %>
            </div>
            <div class="carousel-inner">
                <% @testimonials.each_with_index do |testimonial, index| %>
                    <% if index == 0 %>
                    <div class="carousel-item active">
                    <% else %>
                    <div class="carousel-item">
                    <% end %>
                        <svg aria-hidden="true" class="bd-placeholder-img " height="200px" preserveAspectRatio="xMidYMid slice" width="100%" xmlns="http://www.w3.org/2000/svg">
                            <rect width="100%" height="100%" fill="none"></rect>
                        </svg>
                        <div class="container">
                            <div class="carousel-caption text-start">
                                <figure class="text-end">
                                  <blockquote class="blockquote">
                                    <p><strong>“</strong> <%= testimonial.testimonial %> <strong>”</strong></p>
                                  </blockquote>
                                  <figcaption class="blockquote-footer">
                                    <cite title="<%= testimonial.user.name %> @ <%= testimonial.restaurant.name %>"><%= testimonial.user.name %> @ <%= testimonial.restaurant.name %></cite>
                                  </figcaption>
                                </figure>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden"><%= t('.previous') %></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden"><%= t('.next') %></span>
            </button>
        </div>
      </div>
  <% end %>

  <div id="contact_us" class="container px-1 py-2" id="hanging-icons">
      <div class="row">
        <div class="col-12">
            <h2 class="pb-2 border-bottom"><%= t(".contactUs") %></h2>
            <%= form_with(model: @contact, local: true) do |form| %>

              <div class="form-group row">
                <div class="mb-3">
                  <%= form.label :email, class: 'col-form-label' %>
                  <%= form.email_field :email, class: 'form-control' %>
                  <div id="emailHelp" class="form-text"><%= t(".emailAddressTag") %></div>
                </div>
              </div>
              <div class="form-group row">
                <div class="mb-3">
                  <%= form.label :message, class: 'col-form-label' %>
                  <%= form.text_area :message, class: 'form-control' %>
                </div>
              </div>
              <%= form.submit value: t(".submit"), class: 'float-end btn btn-danger' %>
            <% end %>
        </div>
      </div>
   </div>
<% end %>
